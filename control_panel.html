<!-- THIS EDITION IS NOW DEPRECATED. USE THE SVELTE VERSION INSTEAD. -->
 <!-- DO NOT DELETE THIS OR ANY ASSOCIATED FILES. RETAIN IT FOR HISTORICAL PURPOSES. -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strixun's Stream Suite</title>
    <link rel="stylesheet" href="assets/css/control-panel.css">
    <!-- Auto-configuration (injected during deployment) -->
    <script src="config.js"></script>
    <!-- Storage System (must load first) -->
    <script src="assets/js/storage.js"></script>
    <!-- WebSocket/OBS Connection Module (depends on storage) -->
    <script src="assets/js/websocket.js"></script>
    <!-- Text Cycler Module -->
    <script src="assets/js/text-cycler.js"></script>
    <!-- Storage Sync Module -->
    <script src="assets/js/storage-sync.js"></script>
    <!-- Source Swaps Module -->
    <script src="assets/js/source-swaps.js"></script>
    <!-- Installer Module -->
    <script src="assets/js/modules/installer.js"></script>
    <!-- Source Management Module (depends on websocket) -->
    <script src="assets/js/modules/sources.js"></script>
    <!-- Layout Management Module (depends on websocket, sources) -->
    <script src="assets/js/modules/layouts.js"></script>
    <!-- Script Status Module (depends on websocket) -->
    <script src="assets/js/modules/script-status.js"></script>
    <!-- UI Utilities Module (depends on storage) -->
    <script src="assets/js/ui-utils.js"></script>
    <!-- Version Management Module (depends on storage) -->
    <script src="assets/js/modules/version.js"></script>
    <!-- Twitch API Module (depends on storage, version) -->
    <script src="assets/js/modules/twitch-api.js"></script>
    <!-- Main Application (must load last - initializes everything) -->
    <script src="assets/js/app.js"></script>
</head>
<body>
    <div class="app">
        <header class="header">
            <h1><span class="status-dot" id="statusDot"></span><span class="title-text">Stream Suite</span></h1>
            <div style="display:flex;gap:4px">
                <button onclick="location.reload()" title="Reload Panel">üîÑ</button>
                <button onclick="showPage('setup')" id="connectHeaderBtn">Connect</button>
            </div>
        </header>
        
        <nav class="tabs">
            <button class="tab active" onclick="showPage('dashboard')" title="Dashboard">üè†</button>
            <button class="tab" onclick="showPage('sources')" title="Sources">üì¶</button>
            <button class="tab" onclick="showPage('text')" title="Text Cycler">üìù</button>
            <button class="tab" onclick="showPage('swaps')" title="Swaps">üîÑ</button>
            <button class="tab" onclick="showPage('layouts')" title="Layouts">üìê</button>
            <button class="tab" onclick="showPage('scripts')" title="Script Manager">üìú</button>
            <button class="tab" onclick="showPage('install')" title="Installer">üì•</button>
            <button class="tab" onclick="showPage('setup')" title="Setup">‚öôÔ∏è</button>
        </nav>
        
        <div class="split-container">
            <main class="split-main content">
                <!-- Dashboard -->
                <div id="page-dashboard" class="page active">
                <!-- Script Status Card -->
                <div class="card" id="dashboardStatusCard">
                    <h3>üìä System Status</h3>
                    <div id="dashboardScriptStatus">
                        <div class="script-status-grid">
                            <div class="script-status-item missing">
                                <span class="script-status-item__icon">üîå</span>
                                <span class="script-status-item__name">OBS Connection</span>
                                <span class="script-status-item__badge">Offline</span>
                            </div>
                        </div>
                        <p class="hint" style="margin-top:8px">
                            <button onclick="showPage('setup')" class="btn-link">‚öôÔ∏è Go to Setup</button> to connect to OBS WebSocket
                        </p>
                    </div>
                </div>
                
                <div class="card">
                    <h3>Quick Actions</h3>
                    <div class="grid">
                        <button class="source-btn requires-connection" onclick="cycleAspect()">üîÑ Cycle Aspect</button>
                        <button class="source-btn requires-connection" onclick="refreshScenes()">üîÉ Refresh</button>
                    </div>
                </div>
                
                <div class="card">
                    <h3>Current Scene</h3>
                    <div id="currentScene" class="empty-state">Connect to OBS first</div>
                </div>
                
                <div class="card">
                    <h3>Quick Swaps</h3>
                    <div class="grid" id="dashSwapGrid"></div>
                </div>
            </div>
            
            <!-- Sources -->
            <div id="page-sources" class="page">
                <div class="card">
                    <h3>Visibility Animation</h3>
                    <label>Animation Type</label>
                    <select id="visAnimType">
                        <option value="none">None (instant)</option>
                        <option value="fade" selected>Fade</option>
                        <option value="slide_left">Slide Left</option>
                        <option value="slide_right">Slide Right</option>
                        <option value="slide_up">Slide Up</option>
                        <option value="slide_down">Slide Down</option>
                        <option value="zoom">Zoom</option>
                        <option value="pop">Pop (overshoot)</option>
                    </select>
                    <div class="row" style="margin-top:8px">
                        <div>
                            <label>Duration (ms)</label>
                            <input type="number" id="visAnimDuration" value="300" min="50" max="2000" step="50">
                        </div>
                        <div>
                            <label>Easing</label>
                            <select id="visAnimEasing">
                                <option value="ease">Ease</option>
                                <option value="linear">Linear</option>
                                <option value="easeIn">Ease In</option>
                                <option value="easeOut" selected>Ease Out</option>
                                <option value="bounce">Bounce</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Opacity Control -->
                <div class="card">
                    <h3>üéöÔ∏è Opacity Control</h3>
                    <label>Source</label>
                    <select id="opacitySourceSelect" onchange="loadSourceOpacity()">
                        <option value="">-- Select Source --</option>
                    </select>
                    <div style="margin-top:12px">
                        <div style="display:flex;align-items:center;gap:12px">
                            <input type="range" id="opacitySlider" class="opacity-slider" 
                                   min="0" max="100" value="100" 
                                   oninput="updateOpacityPreview()">
                            <span id="opacityValue" style="font-weight:700;font-size:1.4em;min-width:55px;text-align:right;color:var(--accent)">100%</span>
                        </div>
                    </div>
                    <div class="row" style="margin-top:12px">
                        <button onclick="applySourceOpacity()" style="flex:1">‚úÖ Apply</button>
                        <button onclick="resetSourceOpacity()" class="btn-secondary" style="flex:1">üîÑ Reset to 100%</button>
                    </div>
                    <p class="hint" style="margin-top:8px;font-size:0.75em;color:var(--muted)">
                        üí° Setting to 100% removes the filter (no overhead)
                    </p>
                </div>
                
                <!-- Scene Browser -->
                <div class="card">
                    <h3>üé¨ Scenes</h3>
                    <div class="search-box">
                        <input type="text" class="search-box__input" id="scenesSearchInput" placeholder="Search scenes...">
                        <span class="search-box__icon">üîç</span>
                        <button class="search-box__clear" title="Clear">‚úï</button>
                    </div>
                    <div id="scenesList" class="config-list" style="max-height:200px;overflow-y:auto"></div>
                    <button onclick="refreshSceneList()" class="btn-secondary" style="width:100%;margin-top:8px">üîÉ Refresh Scenes</button>
                </div>
                
                <!-- Source Browser -->
                <div class="card">
                    <h3>üì¶ Sources</h3>
                    <p class="hint" id="sourcesSceneLabel" style="margin-bottom:8px">Select a scene above to view sources</p>
                    <div class="search-box">
                        <input type="text" class="search-box__input" id="sourcesSearchInput" placeholder="Search sources...">
                        <span class="search-box__icon">üîç</span>
                        <button class="search-box__clear" title="Clear">‚úï</button>
                    </div>
                    <div id="sourcesList"></div>
                </div>
            </div>
            
            <!-- Text Cycler -->
            <div id="page-text" class="page">
                <!-- Saved Configs -->
                <div class="card">
                    <h3>üíæ Saved Configs</h3>
                    <div class="search-box">
                        <input type="text" class="search-box__input" id="textConfigsSearchInput" placeholder="Search configs...">
                        <span class="search-box__icon">üîç</span>
                        <button class="search-box__clear" title="Clear">‚úï</button>
                    </div>
                    <div id="textCyclerConfigs" class="config-list"></div>
                    <div class="row" style="margin-top:8px">
                        <button onclick="newTextConfig()">‚ûï New Config</button>
                        <button onclick="exportTextConfigs()">üì§ Export</button>
                        <button onclick="importTextConfigs()">üì• Import</button>
                    </div>
                </div>

                <!-- Config Editor -->
                <div class="card" id="textConfigEditor" style="display:none">
                    <h3>‚úèÔ∏è Edit Config</h3>
                    <label>Config Name</label>
                    <input type="text" id="textConfigName" placeholder="My Text Cycler">
                    
                    <label>Mode</label>
                    <select id="textCyclerMode" onchange="updateTextCyclerMode()">
                        <option value="browser">Browser Source (smooth CSS animations)</option>
                        <option value="legacy">Legacy (OBS text source)</option>
                    </select>
                    <p id="modeInfo" style="font-size:0.75em;color:var(--muted);margin:4px 0 8px"></p>
                    
                    <div id="browserModeSettings">
                        <label>Config ID (for browser source URL)</label>
                        <div class="url-box">
                            <input type="text" id="textConfigId" placeholder="config1" style="flex:1" oninput="updateBrowserSourceUrlPreview()">
                            <button onclick="copyBrowserSourceUrl()">üìã Copy URL</button>
                        </div>
                        <p style="font-size:0.7em;color:var(--muted);margin-top:4px">
                            Add as OBS Browser Source: <code id="browserSourceUrlPreview"></code>
                        </p>
                    </div>
                    
                    <div id="legacyModeSettings" style="display:none">
                        <label>Text Source</label>
                        <select id="textSource" onchange="loadTextSource()">
                            <option value="">-- Select Text Source --</option>
                        </select>
                    </div>
                </div>

                <!-- Text Lines -->
                <div class="card" id="textLinesCard" style="display:none">
                    <h3>üìù Text Lines</h3>
                    <textarea id="textLines" placeholder="Enter text lines (one per line)&#10;Line 1&#10;Line 2&#10;Line 3" rows="5"></textarea>
                </div>
                
                <!-- Animation Settings -->
                <div class="card" id="textAnimationCard" style="display:none">
                    <h3>üé¨ Animation</h3>
                    <label>Transition Effect</label>
                    <select id="textTransition" onchange="updateTransitionMode()">
                        <option value="none">None (instant)</option>
                        <option value="fade">Fade</option>
                        <option value="obfuscate">Obfuscate (Minecraft enchant)</option>
                        <option value="typewriter">Typewriter</option>
                        <option value="glitch">Glitch</option>
                        <option value="scramble">Scramble ‚Üí Snap</option>
                        <option value="wave">Wave Reveal</option>
                        <option value="slide_left">Slide Left</option>
                        <option value="slide_right">Slide Right</option>
                        <option value="slide_up">Slide Up</option>
                        <option value="slide_down">Slide Down</option>
                        <option value="pop">Pop</option>
                    </select>
                    <p id="transitionInfo" style="font-size:0.75em;color:var(--muted);margin:4px 0 12px"></p>
                    <div class="row">
                        <div>
                            <label>Transition (ms)</label>
                            <input type="number" id="transDuration" value="500" min="100" max="3000" step="50">
                        </div>
                        <div>
                            <label>Cycle (ms)</label>
                            <input type="number" id="textDuration" value="3000" min="500" step="100">
                        </div>
                    </div>
                </div>

                <!-- Style Settings (Browser Mode Only) -->
                <div class="card" id="textStyleCard" style="display:none">
                    <h3>üé® Style (Browser Mode)</h3>
                    
                    <label>Font Family</label>
                    <select id="textFontFamily">
                        <option value="'Segoe UI', system-ui, sans-serif">Segoe UI (Default)</option>
                        <option value="Arial, sans-serif">Arial</option>
                        <option value="'Helvetica Neue', Helvetica, sans-serif">Helvetica</option>
                        <option value="Georgia, serif">Georgia</option>
                        <option value="'Times New Roman', serif">Times New Roman</option>
                        <option value="'Courier New', monospace">Courier New</option>
                        <option value="'Trebuchet MS', sans-serif">Trebuchet MS</option>
                        <option value="Verdana, sans-serif">Verdana</option>
                        <option value="Impact, sans-serif">Impact</option>
                        <option value="'Comic Sans MS', cursive">Comic Sans</option>
                    </select>
                    <input type="text" id="textFontFamilyCustom" placeholder="Or enter custom font: 'Font Name', fallback" style="margin-top:4px">
                    
                    <div class="row" style="margin-top:12px">
                        <div>
                            <label>Font Size</label>
                            <input type="text" id="textFontSize" value="48px" placeholder="48px">
                        </div>
                        <div>
                            <label>Font Weight</label>
                            <select id="textFontWeight">
                                <option value="100">Thin</option>
                                <option value="300">Light</option>
                                <option value="400">Normal</option>
                                <option value="500">Medium</option>
                                <option value="600">Semi-Bold</option>
                                <option value="700" selected>Bold</option>
                                <option value="800">Extra Bold</option>
                                <option value="900">Black</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div>
                            <label>Text Color</label>
                            <div style="display:flex;gap:4px">
                                <input type="color" id="textColorPicker" value="#ffffff" style="width:40px;height:32px;padding:0;border:none;cursor:pointer">
                                <input type="text" id="textColor" value="#ffffff" placeholder="#ffffff" style="flex:1">
                            </div>
                        </div>
                        <div>
                            <label>Text Align</label>
                            <select id="textAlign">
                                <option value="center" selected>Center</option>
                                <option value="left">Left</option>
                                <option value="right">Right</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div>
                            <label>Letter Spacing</label>
                            <input type="text" id="textLetterSpacing" value="normal" placeholder="normal, 2px, 0.1em">
                        </div>
                        <div>
                            <label>Line Height</label>
                            <input type="text" id="textLineHeight" value="1.2" placeholder="1.2, 1.5, 2">
                        </div>
                    </div>
                    
                    <div class="row">
                        <div>
                            <label>Text Transform</label>
                            <select id="textTransform">
                                <option value="none" selected>None</option>
                                <option value="uppercase">UPPERCASE</option>
                                <option value="lowercase">lowercase</option>
                                <option value="capitalize">Capitalize</option>
                            </select>
                        </div>
                        <div>
                            <label>Font Style</label>
                            <select id="textFontStyle">
                                <option value="normal" selected>Normal</option>
                                <option value="italic">Italic</option>
                            </select>
                        </div>
                    </div>
                    
                    <label>Text Shadow</label>
                    <input type="text" id="textShadow" value="2px 2px 4px rgba(0,0,0,0.5)" placeholder="2px 2px 4px rgba(0,0,0,0.5)">
                    
                    <label style="margin-top:8px">Text Stroke (Outline)</label>
                    <div class="row">
                        <div>
                            <input type="text" id="textStrokeWidth" value="0" placeholder="Width: 0, 1px, 2px">
                        </div>
                        <div>
                            <div style="display:flex;gap:4px">
                                <input type="color" id="textStrokeColorPicker" value="#000000" style="width:40px;height:32px;padding:0;border:none;cursor:pointer">
                                <input type="text" id="textStrokeColor" value="#000000" placeholder="#000000" style="flex:1">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Preview -->
                <div class="card" id="textPreviewCard" style="display:none">
                    <h3>üëÅÔ∏è Preview</h3>
                    <div class="text-preview" id="textPreview">Select or create a config</div>
                </div>
                
                <!-- Controls -->
                <div id="textControls" style="display:none">
                    <div class="row">
                        <button class="btn-success btn-lg" id="startCycleBtn" onclick="startTextCycler()">‚ñ∂ Start</button>
                        <button class="btn-danger btn-lg" id="stopCycleBtn" onclick="stopTextCycler()" disabled>‚ñ† Stop</button>
                    </div>
                    <div class="row" style="margin-top:8px">
                        <button onclick="saveCurrentTextConfig()">üíæ Save Config</button>
                        <button onclick="deleteCurrentTextConfig()" style="background:var(--danger);border-color:var(--danger)">üóëÔ∏è Delete</button>
                    </div>
                </div>
            </div>
            
            <!-- Swaps -->
            <div id="page-swaps" class="page">
                <div class="card">
                    <h3>Quick Swap</h3>
                    <p style="color:var(--muted);margin-bottom:12px;font-size:0.85em">Select two sources and swap their position/size</p>
                    <label>Source A</label>
                    <select id="swapSourceA"></select>
                    <label>Source B</label>
                    <select id="swapSourceB"></select>
                    <div class="row" style="margin-top:8px">
                        <button class="btn-primary btn-lg" onclick="executeSwap()">üîÑ Swap Now</button>
                    </div>
                </div>
                
                <div class="card">
                    <h3>Animation</h3>
                    <label>Style</label>
                    <select id="swapStyle">
                        <option value="slide" selected>Slide (smooth move)</option>
                        <option value="teleport">Teleport (instant)</option>
                        <option value="scale">Scale (shrink/grow)</option>
                        <option value="bounce">Bounce (overshoot)</option>
                        <option value="elastic">Elastic (springy)</option>
                        <option value="arc">Arc (curved path)</option>
                    </select>
                    <div class="row">
                        <div>
                            <label>Duration (ms)</label>
                            <input type="number" id="swapDuration" value="400" min="0" max="3000" step="50">
                        </div>
                        <div>
                            <label>Easing</label>
                            <select id="swapEasing">
                                <option value="linear">Linear</option>
                                <option value="easeIn">Ease In</option>
                                <option value="easeOut">Ease Out</option>
                                <option value="ease" selected>Ease In-Out</option>
                                <option value="back">Back (overshoot)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div style="margin-top:12px">
                        <label style="display:flex;align-items:center;gap:8px;cursor:pointer">
                            <input type="checkbox" id="swapPreserveAspect" checked>
                            <span>Preserve Aspect Ratio (default)</span>
                        </label>
                    </div>
                    
                    <div style="margin-top:8px">
                        <label>‚ö° Temporary Override</label>
                        <select id="swapTempOverride">
                            <option value="off" selected>Off (use config/global)</option>
                            <option value="preserve">Preserve</option>
                            <option value="stretch">Stretch</option>
                        </select>
                        <p style="font-size:0.75em;color:var(--muted);margin:4px 0 0">Force Preserve or Stretch for ALL swaps until set back to Off</p>
                    </div>
                    
                    <div style="margin-top:8px">
                        <label style="display:flex;align-items:center;gap:8px;cursor:pointer">
                            <input type="checkbox" id="swapDebugLogging">
                            <span>Debug Logging</span>
                        </label>
                    </div>
                </div>
                
                <div class="card">
                    <h3>Add Swap Config</h3>
                    <label>Config Name</label>
                    <input type="text" id="swapConfigName" placeholder="e.g. Camera ‚Üî Gameplay">
                    <div class="row" style="margin-top:8px">
                        <div style="flex:1">
                            <label>Source A</label>
                            <select id="swapNewSourceA"></select>
                        </div>
                        <div style="flex:1">
                            <label>Source B</label>
                            <select id="swapNewSourceB"></select>
                        </div>
                    </div>
                    <button class="btn-primary" style="margin-top:12px;width:100%" onclick="addSwapConfig()">‚ûï Add Config</button>
                </div>
                
                <div class="card">
                    <h3>Saved Configs</h3>
                    <div class="search-box">
                        <input type="text" class="search-box__input" id="swapConfigsSearchInput" placeholder="Search configs...">
                        <span class="search-box__icon">üîç</span>
                        <button class="search-box__clear" title="Clear">‚úï</button>
                    </div>
                    <div id="savedSwaps"></div>
                    <div class="row" style="margin-top:8px">
                        <button onclick="refreshSwapSources()">üîÑ Refresh Sources</button>
                        <button onclick="exportConfigs()">üì§ Export</button>
                        <button onclick="importConfigs()">üì• Import</button>
                    </div>
                </div>
            </div>
            
            <!-- Layouts -->
            <div id="page-layouts" class="page">
                <div class="card">
                    <h3>üíæ Save Current Layout</h3>
                    <p style="color:var(--muted);margin-bottom:12px;font-size:0.85em">
                        Capture all source positions/sizes in current scene
                    </p>
                    <label>Layout Name</label>
                    <input type="text" id="layoutName" placeholder="e.g. Gaming Layout, Just Chatting">
                    <button class="btn-primary" style="margin-top:12px;width:100%" onclick="captureLayout()">
                        üì∏ Capture Current Layout
                    </button>
                </div>
                
                <div class="card">
                    <h3>üìÇ Saved Layouts</h3>
                    <p style="color:var(--muted);margin-bottom:8px;font-size:0.85em" id="layoutSceneInfo">
                        Scene: <span id="layoutCurrentScene">-</span>
                    </p>
                    <div class="search-box">
                        <input type="text" class="search-box__input" id="layoutSearchInput" placeholder="Search layouts...">
                        <span class="search-box__icon">üîç</span>
                        <button class="search-box__clear" title="Clear">‚úï</button>
                    </div>
                    <div id="savedLayouts" class="config-list"></div>
                    <div class="row" style="margin-top:8px">
                        <button onclick="refreshLayouts()">üîÑ Refresh</button>
                    </div>
                </div>
                
                <div class="card">
                    <h3>‚öôÔ∏è Animation Settings</h3>
                    <div class="row">
                        <div style="flex:1">
                            <label>Duration (ms)</label>
                            <input type="number" id="layoutDuration" value="500" min="100" max="2000" step="50">
                        </div>
                        <div style="flex:1">
                            <label>Easing</label>
                            <select id="layoutEasing">
                                <option value="ease_out" selected>Ease Out</option>
                                <option value="ease_in_out">Ease In/Out</option>
                                <option value="ease_in">Ease In</option>
                                <option value="linear">Linear</option>
                                <option value="bounce">Bounce</option>
                                <option value="elastic">Elastic</option>
                                <option value="back">Back</option>
                            </select>
                        </div>
                    </div>
                    <div style="margin-top:8px">
                        <label>Stagger (ms)</label>
                        <input type="number" id="layoutStagger" value="0" min="0" max="200" step="10">
                        <p style="font-size:0.75em;color:var(--muted);margin:4px 0 0">
                            Delay between each source animation (0 = all at once)
                        </p>
                    </div>
                    <div style="margin-top:12px">
                        <label style="display:flex;align-items:center;gap:8px;cursor:pointer">
                            <input type="checkbox" id="layoutApplyVisibility" checked>
                            <span>Apply visibility changes</span>
                        </label>
                    </div>
                </div>
                
                <div class="card">
                    <h3>‚ÑπÔ∏è How It Works</h3>
                    <ol style="padding-left:20px;color:var(--muted);font-size:0.85em;margin:0">
                        <li>Arrange sources how you want them</li>
                        <li>Enter a name and click "Capture"</li>
                        <li>Rearrange sources or change layouts</li>
                        <li>Click "Apply" to animate back</li>
                    </ol>
                    <p style="color:var(--muted);font-size:0.8em;margin-top:8px">
                        üí° <b>Tip:</b> Assign hotkeys in OBS ‚Üí Settings ‚Üí Hotkeys for quick switching!
                    </p>
                </div>
            </div>
            
            <!-- Script Manager -->
            <div id="page-scripts" class="page">
                <div class="card">
                    <h3>üìú Stream Suite Scripts</h3>
                    <p class="hint" style="margin-bottom:12px">Lua scripts that run inside OBS Studio. Install via the Installer tab.</p>
                    
                    <div id="scriptsList" class="scripts-grid"></div>
                </div>
                
                <div class="card">
                    <h3>üåê Browser Sources</h3>
                    <p class="hint" style="margin-bottom:12px">HTML files to add as Browser Sources in OBS.</p>
                    
                    <div class="scripts-grid">
                        <div class="script-card">
                            <div class="script-header">
                                <span class="script-icon">üé¨</span>
                                <div>
                                    <div class="script-name">Text Cycler Display</div>
                                    <div class="script-version">Browser Source</div>
                                </div>
                            </div>
                            <p class="script-desc">Beautiful CSS-animated text display. Receives messages from the control panel for smooth text cycling effects.</p>
                            <div class="script-file">text_cycler_display.html</div>
                        </div>
                        
                        <div class="script-card">
                            <div class="script-header">
                                <span class="script-icon">üéõÔ∏è</span>
                                <div>
                                    <div class="script-name">Control Panel Dock</div>
                                    <div class="script-version">Custom Dock</div>
                                </div>
                            </div>
                            <p class="script-desc">This control panel! Add as a Custom Browser Dock in OBS for quick access to all features.</p>
                            <div class="script-file">control_panel.html</div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <h3>üìñ Quick Reference</h3>
                    <div class="info-box">
                        <strong>Adding Scripts to OBS:</strong>
                        <ol style="margin:8px 0 0 16px;font-size:0.85em">
                            <li>Tools ‚Üí Scripts</li>
                            <li>Click + (Add Scripts)</li>
                            <li>Navigate to your script folder</li>
                            <li>Select the .lua files</li>
                        </ol>
                    </div>
                    <div class="info-box" style="margin-top:8px">
                        <strong>Adding Custom Browser Dock:</strong>
                        <ol style="margin:8px 0 0 16px;font-size:0.85em">
                            <li>View ‚Üí Docks ‚Üí Custom Browser Docks</li>
                            <li>Name: "Stream Suite"</li>
                            <li>URL: file:///path/to/control_panel.html</li>
                        </ol>
                    </div>
                </div>
            </div>
            
            <!-- Installer Wizard -->
            <div id="page-install" class="page">
                <div class="card">
                    <h3>üì• Installation Wizard</h3>
                    <p class="hint">Automatically install Lua scripts to your OBS scripts folder.</p>
                    
                    <!-- Step 1: Detect/Select Paths -->
                    <div id="installStep1" class="install-step active">
                        <h4>Step 1: Configure Paths</h4>
                        
                        <label>Source Files Location</label>
                        <div class="url-box">
                            <input type="text" id="installSourcePath" readonly>
                            <button onclick="window.Installer.detectSourcePath()">üîç Detect</button>
                        </div>
                        <p class="hint">Where the script files are located (this folder)</p>
                        
                        <label>OBS Scripts Folder</label>
                        <div class="url-box">
                            <input type="text" id="installTargetPath" placeholder="C:\Users\YourName\AppData\Roaming\obs-studio\scripts">
                            <button onclick="window.Installer.browseTargetPath()">üìÅ Browse</button>
                            <button onclick="window.Installer.detectOBSPath()">üîç Auto-Detect</button>
                        </div>
                        <p class="hint">Where scripts will be installed. Common locations:</p>
                        <div class="path-suggestions" id="pathSuggestions"></div>
                        
                        <div class="row" style="margin-top:12px">
                            <button onclick="window.Installer.goToInstallStep(2)" class="btn-primary">Next: Select Scripts ‚Üí</button>
                        </div>
                    </div>
                    
                    <!-- Step 2: Select Scripts -->
                    <div id="installStep2" class="install-step">
                        <h4>Step 2: Select Scripts to Install</h4>
                        
                        <div id="installScriptsList" class="install-scripts-list"></div>
                        
                        <div class="row" style="margin-top:12px">
                            <button onclick="window.Installer.goToInstallStep(1)">‚Üê Back</button>
                            <button onclick="window.Installer.goToInstallStep(3)" class="btn-primary">Next: Review ‚Üí</button>
                        </div>
                    </div>
                    
                    <!-- Step 3: Review & Install -->
                    <div id="installStep3" class="install-step">
                        <h4>Step 3: Review & Install</h4>
                        
                        <div id="installReview" class="install-review"></div>
                        
                        <div class="install-method-select" style="margin-top:12px">
                            <label>Installation Method</label>
                            <select id="installMethod">
                                <option value="powershell">PowerShell Script (Windows)</option>
                                <option value="batch">Batch File (Windows)</option>
                                <option value="bash">Bash Script (Linux/Mac)</option>
                                <option value="manual">Manual Instructions</option>
                            </select>
                        </div>
                        
                        <div class="row" style="margin-top:12px">
                            <button onclick="window.Installer.goToInstallStep(2)">‚Üê Back</button>
                            <button onclick="window.Installer.generateInstallScript()" class="btn-primary">Generate Install Script</button>
                        </div>
                    </div>
                    
                    <!-- Step 4: Execute/Copy Script -->
                    <div id="installStep4" class="install-step">
                        <h4>Step 4: Run Installation</h4>
                        
                        <div id="installOutput" class="install-output"></div>
                        
                        <!-- Dock Warning -->
                        <div id="dockDownloadWarning" class="feature-notice" style="display:none;margin-bottom:12px">
                            <div class="feature-notice__title">‚ö†Ô∏è OBS Dock Detected</div>
                            <div class="feature-notice__text">
                                File downloads don't work in OBS docks. Use <strong>Copy Script</strong> instead, 
                                then paste into a text editor and save manually.
                            </div>
                        </div>
                        
                        <div class="row" style="margin-top:12px">
                            <button onclick="window.Installer.goToInstallStep(3)">‚Üê Back</button>
                            <button onclick="window.Installer.copyInstallScript()" class="btn-success">üìã Copy Script</button>
                            <button onclick="window.Installer.downloadInstallScript()" id="downloadScriptBtn" class="btn-primary" title="Download install script">üíæ Download</button>
                        </div>
                        
                        <!-- Browser Instructions (shown when NOT in dock) -->
                        <div id="browserInstructions" class="info-box" style="margin-top:12px">
                            <strong>After downloading:</strong>
                            <ol style="margin:4px 0 0 16px;font-size:0.85em">
                                <li>Right-click the downloaded script</li>
                                <li>Run as Administrator (Windows) or chmod +x && run (Linux/Mac)</li>
                                <li>Restart OBS Studio</li>
                                <li>Go to Tools ‚Üí Scripts to configure</li>
                            </ol>
                        </div>
                        
                        <!-- Dock Instructions (shown when IN dock) -->
                        <div id="dockInstructions" class="info-box" style="display:none;margin-top:12px">
                            <strong>üìã After copying the script:</strong>
                            <ol style="margin:4px 0 0 16px;font-size:0.85em">
                                <li>Open Notepad, VS Code, or any text editor</li>
                                <li>Paste the script (Ctrl+V)</li>
                                <li>Save as <code>.ps1</code> (PowerShell), <code>.bat</code> (Batch), or <code>.sh</code> (Bash)</li>
                                <li>Run the saved file as Administrator</li>
                                <li>Restart OBS Studio</li>
                            </ol>
                            <p style="margin-top:8px;font-size:0.85em;color:var(--muted)">
                                üí° <strong>Tip:</strong> Open this control panel in your regular browser for easier downloading!
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- Existing Installation Detection -->
                <div class="card" id="existingInstallCard" style="display:none">
                    <h3>‚ö†Ô∏è Existing Installation Detected</h3>
                    <div id="existingInstallInfo"></div>
                    <div class="row" style="margin-top:12px">
                        <button onclick="window.Installer.handleExistingInstall('skip')">Skip Existing</button>
                        <button onclick="window.Installer.handleExistingInstall('backup')" class="btn-warning">Backup & Replace</button>
                        <button onclick="window.Installer.handleExistingInstall('replace')" class="btn-danger">Replace All</button>
                    </div>
                </div>
                
            </div>
            
            <!-- Setup -->
            <div id="page-setup" class="page">
                <div class="card">
                    <h3>Connection</h3>
                    <div class="row">
                        <div>
                            <label>Host</label>
                            <input type="text" id="host" value="localhost">
                        </div>
                        <div>
                            <label>Port</label>
                            <input type="text" id="port" value="4455">
                        </div>
                    </div>
                    <label>Password</label>
                    <input type="password" id="password" placeholder="Leave empty if not set">
                    <div style="margin:8px 0">
                        <label style="display:flex;align-items:center;gap:8px;cursor:pointer">
                            <input type="checkbox" id="rememberCreds" style="width:auto;margin:0">
                            <span>Remember credentials</span>
                        </label>
                        <p style="font-size:0.75em;color:var(--warning);margin-top:4px" id="securityWarning"></p>
                        <button type="button" onclick="clearSavedCredentials()" style="font-size:0.75em;padding:4px 8px;margin-top:4px;background:var(--danger);border:none;color:#fff;border-radius:4px;cursor:pointer">Clear Saved Credentials</button>
                    </div>
                    <button class="btn-primary btn-block" id="connectBtn" onclick="toggleConnection()">Connect</button>
                </div>
                
                <div class="card">
                    <h3>Add as OBS Dock</h3>
                    <p style="color:var(--muted);margin-bottom:12px;font-size:0.9em">
                        In OBS: <strong>View ‚Üí Docks ‚Üí Custom Browser Docks</strong><br>
                        Click + and paste this URL:
                    </p>
                    <div class="url-box">
                        <input type="text" id="dockUrl" readonly>
                        <button onclick="copyUrl()">üìã Copy</button>
                    </div>
                    <p style="color:var(--muted);margin-top:8px;font-size:0.85em" id="copyStatus"></p>
                </div>
                
                <div class="card">
                    <h3>OBS WebSocket Setup</h3>
                    <ol style="color:var(--muted);padding-left:20px;font-size:0.9em;line-height:2">
                        <li>In OBS: <strong>Tools ‚Üí WebSocket Server Settings</strong></li>
                        <li>Check "Enable WebSocket server"</li>
                        <li>Note the port (default: 4455)</li>
                        <li>Set password if desired</li>
                        <li>Click Apply, then connect here</li>
                    </ol>
                </div>
                
                <div class="card">
                    <h3>üéÆ Twitch API Settings</h3>
                    <p style="color:var(--muted);font-size:0.85em;margin-bottom:12px">
                        Get credentials from 
                        <button onclick="openUrlOrCopy('https://dev.twitch.tv/console/apps', 'Twitch Developer Console')" class="btn-link">dev.twitch.tv/console</button>
                    </p>
                    
                    <label>Twitch Client ID <span style="color:var(--muted);font-weight:normal">(Optional - Auto-configured)</span></label>
                    <input type="text" id="twitchClientId" placeholder="Auto-configured from deployment">
                    <p class="hint" style="margin-top:4px;font-size:0.75em">
                        ‚ú® Auto-configured during deployment. Only override if using a different Twitch app.
                        <span id="autoDetectedClientId" style="display:block;margin-top:4px;color:var(--success)"></span>
                    </p>
                    
                    <label style="margin-top:12px">API Server URL <span style="color:var(--muted);font-weight:normal">(Optional - Auto-detected)</span></label>
                    <input type="text" id="twitchApiServer" placeholder="Auto-detected from deployment config">
                    <p class="hint" style="margin-top:4px;font-size:0.75em">
                        ‚ú® Auto-configured during GitHub Pages deployment. Only override if using a custom Worker URL.
                        <span id="autoDetectedApiUrl" style="display:block;margin-top:4px;color:var(--success)"></span>
                    </p>
                    
                    <div style="margin-top:12px;padding:8px;background:rgba(255,255,255,0.05);border-radius:6px;font-size:0.8em">
                        <strong style="color:var(--accent)">OAuth Redirect URI:</strong>
                        <code style="display:block;margin-top:4px;padding:6px;background:var(--bg);border-radius:4px;word-break:break-all;user-select:all">https://underwood-inc.github.io/strixun-stream-suite/twitch_auth_callback.html</code>
                        <p style="color:var(--muted);margin-top:4px">‚òùÔ∏è Add this URL to your Twitch app's OAuth Redirect URLs</p>
                    </div>
                    
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:12px">
                        <button onclick="saveTwitchSettings()" style="padding:8px;background:var(--primary);border:none;color:#fff;border-radius:6px;cursor:pointer">üíæ Save Settings</button>
                        <button onclick="testTwitchApi()" style="padding:8px;background:rgba(255,255,255,0.1);border:none;color:#fff;border-radius:6px;cursor:pointer">üîå Test Connection</button>
                    </div>
                    <div id="twitchApiStatus" style="margin-top:8px;font-size:0.8em;text-align:center;color:var(--muted)"></div>
                </div>
                
                <div class="card">
                    <h3>Keyboard Shortcuts</h3>
                    <p style="color:var(--muted);font-size:0.9em">When this panel is focused:</p>
                    <ul style="color:var(--muted);padding-left:20px;font-size:0.9em;line-height:2">
                        <li><strong>1-9</strong> - Trigger saved swap configs</li>
                        <li><strong>Space</strong> - Start/stop text cycler</li>
                    </ul>
                </div>
                
                <div class="card">
                    <h3>üîÑ Cross-Client Sync</h3>
                    <p style="color:var(--muted);font-size:0.85em;margin-bottom:8px">
                        Sync configs between OBS dock and remote browser panels via WebSocket.
                    </p>
                    <div style="display:grid;gap:8px">
                        <button class="btn-primary btn-block requires-connection" onclick="requestStorageFromOBS()">
                            üì• Pull Storage from OBS Dock
                        </button>
                        <button class="btn-block requires-connection" onclick="manualStorageSync()" style="background:var(--border)">
                            üì° Push Storage to Other Clients
                        </button>
                    </div>
                    <p class="hint" style="margin-top:6px">
                        <strong>Pull</strong> = Overwrite local with OBS dock's storage<br>
                        <strong>Push</strong> = Send your storage to other clients
                    </p>
                    <div class="form-check" style="margin-top:8px">
                        <input type="checkbox" id="autoSyncOnConnect" checked onchange="saveAutoSyncPref()">
                        <label for="autoSyncOnConnect">Auto-pull from OBS on connect</label>
                    </div>
                </div>
                
                <div class="card">
                    <h3>üíæ Data & Backup</h3>
                    
                    <!-- Storage Engine Status -->
                    <div id="storageEngineStatus" style="display:flex;gap:12px;margin-bottom:12px;padding:8px;background:rgba(0,0,0,0.2);border-radius:6px;font-size:0.85em">
                        <span id="idbStatus">‚è≥ IndexedDB</span>
                        <span id="lsStatus">‚è≥ localStorage</span>
                    </div>
                    
                    <!-- Data Categories -->
                    <div style="margin-bottom:12px">
                        <div style="font-size:0.8em;color:var(--muted);margin-bottom:6px;font-weight:600">SELECT DATA TO EXPORT:</div>
                        <div style="display:grid;gap:6px">
                            <label style="display:flex;align-items:center;gap:8px;padding:6px 8px;background:rgba(255,255,255,0.05);border-radius:4px;cursor:pointer;font-size:0.85em">
                                <input type="checkbox" id="exportSwaps" checked style="width:auto;margin:0">
                                <span>üîÑ Swap Configs</span>
                                <span id="swapCount" style="margin-left:auto;color:var(--muted);font-size:0.9em">(0)</span>
                            </label>
                            <label style="display:flex;align-items:center;gap:8px;padding:6px 8px;background:rgba(255,255,255,0.05);border-radius:4px;cursor:pointer;font-size:0.85em">
                                <input type="checkbox" id="exportLayouts" checked style="width:auto;margin:0">
                                <span>üìê Layout Presets</span>
                                <span id="layoutCount" style="margin-left:auto;color:var(--muted);font-size:0.9em">(0)</span>
                            </label>
                            <label style="display:flex;align-items:center;gap:8px;padding:6px 8px;background:rgba(255,255,255,0.05);border-radius:4px;cursor:pointer;font-size:0.85em">
                                <input type="checkbox" id="exportTextCyclers" checked style="width:auto;margin:0">
                                <span>üìù Text Cycler Configs</span>
                                <span id="textCyclerCount" style="margin-left:auto;color:var(--muted);font-size:0.9em">(0)</span>
                            </label>
                            <label style="display:flex;align-items:center;gap:8px;padding:6px 8px;background:rgba(255,255,255,0.05);border-radius:4px;cursor:pointer;font-size:0.85em">
                                <input type="checkbox" id="exportUIState" checked style="width:auto;margin:0">
                                <span>‚öôÔ∏è UI Preferences</span>
                                <span style="margin-left:auto;color:var(--muted);font-size:0.9em">(dropdowns, settings)</span>
                            </label>
                            <label style="display:flex;align-items:center;gap:8px;padding:6px 8px;background:rgba(255,255,255,0.05);border-radius:4px;cursor:pointer;font-size:0.85em">
                                <input type="checkbox" id="exportCredentials" style="width:auto;margin:0">
                                <span>üîê Connection Settings</span>
                                <span style="margin-left:auto;color:var(--warning);font-size:0.8em">(host/port only)</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- Action Buttons -->
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-bottom:8px">
                        <button onclick="exportSelectedData()" style="padding:10px;background:var(--primary);border:none;color:#fff;border-radius:6px;cursor:pointer;font-weight:500">üì§ Export Selected</button>
                        <button onclick="importDataWithOptions()" style="padding:10px;background:var(--accent);border:none;color:#000;border-radius:6px;cursor:pointer;font-weight:500">üì• Import Backup</button>
                    </div>
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
                        <button onclick="forceStorageSync()" style="padding:8px;background:rgba(255,255,255,0.1);border:none;color:#fff;border-radius:6px;cursor:pointer;font-size:0.85em">üîÑ Force Sync</button>
                        <button onclick="copyBackupToClipboard()" style="padding:8px;background:rgba(255,255,255,0.1);border:none;color:#fff;border-radius:6px;cursor:pointer;font-size:0.85em">üìã Copy as JSON</button>
                    </div>
                    
                    <!-- Info -->
                    <div style="margin-top:10px;padding:8px;background:rgba(255,200,0,0.1);border-radius:6px;border-left:3px solid var(--warning)">
                        <p style="font-size:0.75em;color:var(--warning);margin:0">‚ö†Ô∏è <strong>OBS browser docks can lose data</strong> when cache is cleared. Export backups regularly!</p>
                    </div>
                    
                    <!-- Last backup info -->
                    <div id="lastBackupInfo" style="margin-top:8px;font-size:0.75em;color:var(--muted);text-align:center"></div>
                </div>
                
                <!-- Version Info -->
                <div class="card">
                    <h3>üì¶ Version</h3>
                    <div id="versionInfo" style="font-size:0.9em">
                        <div style="display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid rgba(255,255,255,0.1)">
                            <span style="color:var(--muted)">Local Version:</span>
                            <span id="localVersion" style="font-weight:600;font-family:monospace">--</span>
                        </div>
                        <div style="display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid rgba(255,255,255,0.1)">
                            <span style="color:var(--muted)">Remote (main):</span>
                            <span id="remoteVersion" style="font-weight:600;font-family:monospace">--</span>
                        </div>
                        <div id="versionStatus" style="margin-top:10px;padding:8px;border-radius:6px;text-align:center;font-size:0.85em">
                            <span style="color:var(--muted)">Click below to check for updates</span>
                        </div>
                    </div>
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px;margin-top:12px">
                        <button onclick="checkForUpdates()" style="padding:8px;background:var(--primary);border:none;color:#fff;border-radius:6px;cursor:pointer;font-size:0.85em">üîÑ Check Updates</button>
                        <button onclick="openGitHubRepo()" style="padding:8px;background:rgba(255,255,255,0.1);border:none;color:#fff;border-radius:6px;cursor:pointer;font-size:0.85em">üêô Open GitHub</button>
                    </div>
                    <div style="margin-top:10px;font-size:0.75em;color:var(--muted);text-align:center">
                        <span id="lastVersionCheck">Never checked</span>
                    </div>
                </div>
            </div>
            </main>
            
            <!-- Draggable Divider -->
            <div class="split-divider" id="splitDivider" title="Drag to resize"></div>
            
            <!-- Persistent Activity Log Panel -->
            <div class="split-log" id="splitLog">
                <div class="split-log__header">
                    <button class="split-log__toggle" id="logToggle" title="Toggle Log">‚ñº</button>
                    <span class="split-log__title">Activity Log</span>
                    <div class="search-box split-log__search">
                        <input type="text" class="search-box__input" id="logSearchInput" placeholder="Search log...">
                        <span class="search-box__icon">üîç</span>
                        <button class="search-box__clear" id="logSearchClear" title="Clear search">‚úï</button>
                    </div>
                    <button class="split-log__clear btn-link" onclick="clearLog()">Clear</button>
                </div>
                <div class="split-log__content" id="log"></div>
            </div>
        </div>
    </div>

<!-- All JavaScript has been extracted to external modules -->
<!-- Main application logic is in assets/js/app.js -->
<!-- See individual module files in assets/js/ for feature-specific code -->
</body>
</html>
