name = "strixun-url-shortener"
main = "worker.ts"
compatibility_date = "2024-01-01"

# Build is handled by GitHub Actions workflow before deployment
# The workflow runs: pnpm build:all
# Then deploys with: wrangler deploy --no-bundle
# [build]
# command = "pnpm build:all"

[env.production]
vars = { ENVIRONMENT = "production" }
# Custom domain route (s.idling.app/*) is managed in Cloudflare Dashboard
# Routes configured in the dashboard take precedence over wrangler.toml
# KV Namespace for storing URL mappings
# Created via: wrangler kv namespace create "URL_SHORTENER_KV"
[[env.production.kv_namespaces]]
binding = "URL_KV"
id = "aed413a5133e445fbe4d91c1a080369e"
preview_id = "7bebce133d884ffda2f34e4398acd660"

# Analytics KV Namespace (optional, for tracking clicks)
# Created via: wrangler kv namespace create "URL_SHORTENER_ANALYTICS"
[[env.production.kv_namespaces]]
binding = "ANALYTICS_KV"
id = "486b241817f34f76b0cbb44d81205ce3"
preview_id = "b0e590fa55ce4513af3c5e07068372ef"

[env.development]
vars = { ENVIRONMENT = "development" }

# Development KV Namespace for storing URL mappings
[[env.development.kv_namespaces]]
binding = "URL_KV"
id = "aed413a5133e445fbe4d91c1a080369e"
preview_id = "7bebce133d884ffda2f34e4398acd660"

# Development Analytics KV Namespace (optional, for tracking clicks)
[[env.development.kv_namespaces]]
binding = "ANALYTICS_KV"
id = "486b241817f34f76b0cbb44d81205ce3"
preview_id = "b0e590fa55ce4513af3c5e07068372ef"

# Default to production for backward compatibility
[vars]
ENVIRONMENT = "production"

# Default KV Namespaces (required for routes configured in dashboard or when no environment is specified)
[[kv_namespaces]]
binding = "URL_KV"
id = "aed413a5133e445fbe4d91c1a080369e"

[[kv_namespaces]]
binding = "ANALYTICS_KV"
id = "486b241817f34f76b0cbb44d81205ce3"

# Note: Create KV namespaces with:
# wrangler kv namespace create "URL_SHORTENER_KV"
# wrangler kv namespace create "URL_SHORTENER_ANALYTICS"
# Then update the IDs above

# Environment variables (secrets should be set via wrangler secret put)
# DO NOT put actual secrets here - use wrangler CLI:
#   wrangler secret put JWT_SECRET
#   IMPORTANT: Use the SAME JWT_SECRET as your OTP auth service for compatibility
#   wrangler secret put ALLOWED_ORIGINS (optional, comma-separated)

# Alternative: Configure in Cloudflare Dashboard (recommended for production):
# 1. Go to Cloudflare Dashboard ΓåÆ Workers & Pages ΓåÆ strixun-url-shortener
# 2. Go to Settings ΓåÆ Triggers ΓåÆ Routes
# 3. Add custom domain route: s.idling.app/*
# 4. DNS records are automatically managed by Cloudflare
#
# Note: Routes configured in the dashboard take precedence over wrangler.toml
