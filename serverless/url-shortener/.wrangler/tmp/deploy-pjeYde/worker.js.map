{
  "version": 3,
  "sources": ["../../../worker.js"],
  "sourceRoot": "C:\\Users\\mamop\\Documents\\source fade script plugin\\serverless\\url-shortener\\.wrangler\\tmp\\deploy-pjeYde",
  "sourcesContent": ["/**\r\n * Strixun URL Shortener Service\r\n * \r\n * Cloudflare Worker for URL shortening with OTP authentication integration\r\n * Provides free URL shortening service with user authentication\r\n * \r\n * @version 1.0.0\r\n */\r\n\r\n/**\r\n * Get CORS headers with dynamic origin whitelist\r\n * @param {*} env - Worker environment\r\n * @param {Request} request - Request object\r\n * @returns {Object} CORS headers\r\n */\r\nfunction getCorsHeaders(env, request) {\r\n  const origin = request.headers.get('Origin');\r\n  \r\n  // Get allowed origins from environment (comma-separated)\r\n  const allowedOrigins = env.ALLOWED_ORIGINS ? env.ALLOWED_ORIGINS.split(',').map(o => o.trim()) : [];\r\n  \r\n  // If no origins configured, allow all (for development only)\r\n  // In production, you MUST set ALLOWED_ORIGINS via: wrangler secret put ALLOWED_ORIGINS\r\n  const allowOrigin = allowedOrigins.length > 0 \r\n      ? (origin && allowedOrigins.includes(origin) ? origin : null)\r\n      : '*'; // Fallback for development\r\n  \r\n  return {\r\n      'Access-Control-Allow-Origin': allowOrigin || 'null',\r\n      'Access-Control-Allow-Methods': 'GET, POST, PUT, DELETE, OPTIONS',\r\n      'Access-Control-Allow-Headers': 'Content-Type, Authorization, X-Requested-With',\r\n      'Access-Control-Allow-Credentials': allowOrigin !== '*' ? 'true' : 'false',\r\n      'Access-Control-Max-Age': '86400',\r\n      // Security headers\r\n      'X-Content-Type-Options': 'nosniff',\r\n      'X-Frame-Options': 'DENY',\r\n      'X-XSS-Protection': '1; mode=block',\r\n      'Strict-Transport-Security': 'max-age=31536000; includeSubDomains',\r\n      'Content-Security-Policy': \"default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'\",\r\n  };\r\n}\r\n\r\n/**\r\n * Verify JWT token (compatible with OTP auth service)\r\n */\r\nasync function verifyJWT(token, secret) {\r\n  try {\r\n    const parts = token.split('.');\r\n    if (parts.length !== 3) return null;\r\n\r\n    const [headerB64, payloadB64, signatureB64] = parts;\r\n    const encoder = new TextEncoder();\r\n    const signatureInput = `${headerB64}.${payloadB64}`;\r\n    const keyData = encoder.encode(secret);\r\n    const key = await crypto.subtle.importKey(\r\n      'raw',\r\n      keyData,\r\n      { name: 'HMAC', hash: 'SHA-256' },\r\n      false,\r\n      ['verify']\r\n    );\r\n\r\n    const signature = Uint8Array.from(\r\n      atob(signatureB64.replace(/-/g, '+').replace(/_/g, '/')),\r\n      c => c.charCodeAt(0)\r\n    );\r\n\r\n    const isValid = await crypto.subtle.verify(\r\n      'HMAC',\r\n      key,\r\n      signature,\r\n      encoder.encode(signatureInput)\r\n    );\r\n\r\n    if (!isValid) return null;\r\n\r\n    const payload = JSON.parse(\r\n      atob(payloadB64.replace(/-/g, '+').replace(/_/g, '/'))\r\n    );\r\n\r\n    if (payload.exp && payload.exp < Math.floor(Date.now() / 1000)) {\r\n      return null;\r\n    }\r\n\r\n    return payload;\r\n  } catch (error) {\r\n    return null;\r\n  }\r\n}\r\n\r\n/**\r\n * Get JWT secret from environment\r\n * @param {*} env - Worker environment\r\n * @returns {string} JWT secret\r\n * @throws {Error} If JWT_SECRET is not set\r\n */\r\nfunction getJWTSecret(env) {\r\n  if (!env.JWT_SECRET) {\r\n    throw new Error('JWT_SECRET environment variable is required. Set it via: wrangler secret put JWT_SECRET. IMPORTANT: Use the SAME secret as your OTP auth service.');\r\n  }\r\n  return env.JWT_SECRET;\r\n}\r\n\r\n/**\r\n * Authenticate request using OTP auth JWT tokens\r\n */\r\nasync function authenticateRequest(request, env) {\r\n  const authHeader = request.headers.get('Authorization');\r\n  if (!authHeader || !authHeader.startsWith('Bearer ')) {\r\n    return { authenticated: false, status: 401, error: 'Authorization header required' };\r\n  }\r\n\r\n  const token = authHeader.substring(7);\r\n  const jwtSecret = getJWTSecret(env);\r\n  const payload = await verifyJWT(token, jwtSecret);\r\n\r\n  if (!payload) {\r\n    return { authenticated: false, status: 401, error: 'Invalid or expired token' };\r\n  }\r\n\r\n  return {\r\n    authenticated: true,\r\n    // Support both old format (userId) and OIDC format (sub)\r\n    userId: payload.userId || payload.sub,\r\n    email: payload.email,\r\n    customerId: payload.customerId || payload.aud || null,\r\n  };\r\n}\r\n\r\n/**\r\n * Generate a short code for URL\r\n * @param {number} length - Length of the code (default: 6)\r\n * @returns {string} Short code\r\n */\r\nfunction generateShortCode(length = 6) {\r\n  const chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';\r\n  let code = '';\r\n  const randomValues = crypto.getRandomValues(new Uint8Array(length));\r\n  for (let i = 0; i < length; i++) {\r\n    code += chars[randomValues[i] % chars.length];\r\n  }\r\n  return code;\r\n}\r\n\r\n/**\r\n * Validate URL\r\n * @param {string} url - URL to validate\r\n * @returns {boolean} True if valid\r\n */\r\nfunction isValidUrl(url) {\r\n  try {\r\n    const urlObj = new URL(url);\r\n    return urlObj.protocol === 'http:' || urlObj.protocol === 'https:';\r\n  } catch {\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * Validate short code format\r\n * @param {string} code - Code to validate\r\n * @returns {boolean} True if valid\r\n */\r\nfunction isValidShortCode(code) {\r\n  return /^[a-zA-Z0-9_-]{3,20}$/.test(code);\r\n}\r\n\r\n/**\r\n * Create short URL\r\n * POST /api/create\r\n */\r\nasync function handleCreateShortUrl(request, env) {\r\n  try {\r\n    // Authenticate user\r\n    const auth = await authenticateRequest(request, env);\r\n    if (!auth.authenticated) {\r\n      return new Response(JSON.stringify({ error: auth.error }), {\r\n        status: auth.status,\r\n        headers: { ...getCorsHeaders(env, request), 'Content-Type': 'application/json' },\r\n      });\r\n    }\r\n\r\n    const body = await request.json();\r\n    const { url, customCode, expiresIn } = body;\r\n\r\n    // Validate URL\r\n    if (!url || !isValidUrl(url)) {\r\n      return new Response(JSON.stringify({ error: 'Valid URL required (must start with http:// or https://)' }), {\r\n        status: 400,\r\n        headers: { ...getCorsHeaders(env, request), 'Content-Type': 'application/json' },\r\n      });\r\n    }\r\n\r\n    // Validate custom code if provided\r\n    let shortCode = customCode;\r\n    if (shortCode) {\r\n      if (!isValidShortCode(shortCode)) {\r\n        return new Response(JSON.stringify({ error: 'Custom code must be 3-20 characters and contain only letters, numbers, hyphens, and underscores' }), {\r\n          status: 400,\r\n          headers: { ...getCorsHeaders(env, request), 'Content-Type': 'application/json' },\r\n        });\r\n      }\r\n\r\n      // Check if custom code already exists\r\n      const existingKey = `url_${shortCode}`;\r\n      const existing = await env.URL_KV.get(existingKey);\r\n      if (existing) {\r\n        return new Response(JSON.stringify({ error: 'Custom code already in use' }), {\r\n          status: 409,\r\n          headers: { ...getCorsHeaders(env, request), 'Content-Type': 'application/json' },\r\n        });\r\n      }\r\n    } else {\r\n      // Generate unique short code\r\n      let attempts = 0;\r\n      do {\r\n        shortCode = generateShortCode(6);\r\n        const existingKey = `url_${shortCode}`;\r\n        const existing = await env.URL_KV.get(existingKey);\r\n        if (!existing) break;\r\n        attempts++;\r\n        if (attempts > 10) {\r\n          shortCode = generateShortCode(8); // Try longer code\r\n        }\r\n        if (attempts > 20) {\r\n          return new Response(JSON.stringify({ error: 'Failed to generate unique code' }), {\r\n            status: 500,\r\n            headers: { ...getCorsHeaders(env, request), 'Content-Type': 'application/json' },\r\n          });\r\n        }\r\n      } while (true);\r\n    }\r\n\r\n    // Calculate expiration TTL (default: 1 year, max: 10 years)\r\n    let expirationTtl = 31536000; // 1 year in seconds\r\n    if (expiresIn) {\r\n      const expiresInNum = parseInt(expiresIn, 10);\r\n      if (!isNaN(expiresInNum) && expiresInNum > 0) {\r\n        expirationTtl = Math.min(expiresInNum, 315360000); // Max 10 years\r\n      }\r\n    }\r\n\r\n    // Store URL mapping\r\n    const urlData = {\r\n      url,\r\n      shortCode,\r\n      userId: auth.userId,\r\n      email: auth.email,\r\n      createdAt: new Date().toISOString(),\r\n      clickCount: 0,\r\n      expiresAt: new Date(Date.now() + expirationTtl * 1000).toISOString(),\r\n    };\r\n\r\n    const urlKey = `url_${shortCode}`;\r\n    await env.URL_KV.put(urlKey, JSON.stringify(urlData), { expirationTtl });\r\n\r\n    // Store in user's URL list\r\n    const userUrlsKey = `user_urls_${auth.userId}`;\r\n    const userUrls = await env.URL_KV.get(userUrlsKey, { type: 'json' }) || [];\r\n    userUrls.push({\r\n      shortCode,\r\n      url,\r\n      createdAt: urlData.createdAt,\r\n      clickCount: 0,\r\n    });\r\n    await env.URL_KV.put(userUrlsKey, JSON.stringify(userUrls), { expirationTtl });\r\n\r\n    // Get base URL from request\r\n    const requestUrl = new URL(request.url);\r\n    const baseUrl = `${requestUrl.protocol}//${requestUrl.host}`;\r\n    const shortUrl = `${baseUrl}/${shortCode}`;\r\n\r\n    return new Response(JSON.stringify({\r\n      success: true,\r\n      shortUrl,\r\n      shortCode,\r\n      originalUrl: url,\r\n      expiresAt: urlData.expiresAt,\r\n    }), {\r\n      headers: { ...getCorsHeaders(env, request), 'Content-Type': 'application/json' },\r\n    });\r\n  } catch (error) {\r\n    return new Response(JSON.stringify({\r\n      error: 'Failed to create short URL',\r\n      message: error.message,\r\n    }), {\r\n      status: 500,\r\n      headers: { ...getCorsHeaders(env, request), 'Content-Type': 'application/json' },\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Redirect to original URL\r\n * GET /:shortCode\r\n */\r\nasync function handleRedirect(request, env) {\r\n  try {\r\n    const url = new URL(request.url);\r\n    const shortCode = url.pathname.slice(1); // Remove leading /\r\n\r\n    if (!shortCode || shortCode.includes('/')) {\r\n      return new Response(JSON.stringify({ error: 'Invalid short code' }), {\r\n        status: 400,\r\n        headers: { ...getCorsHeaders(env, request), 'Content-Type': 'application/json' },\r\n      });\r\n    }\r\n\r\n    const urlKey = `url_${shortCode}`;\r\n    const urlDataStr = await env.URL_KV.get(urlKey);\r\n\r\n    if (!urlDataStr) {\r\n      return new Response(JSON.stringify({ error: 'Short URL not found' }), {\r\n        status: 404,\r\n        headers: { ...getCorsHeaders(env, request), 'Content-Type': 'application/json' },\r\n      });\r\n    }\r\n\r\n    const urlData = JSON.parse(urlDataStr);\r\n\r\n    // Update click count\r\n    urlData.clickCount = (urlData.clickCount || 0) + 1;\r\n    await env.URL_KV.put(urlKey, JSON.stringify(urlData));\r\n\r\n    // Track analytics\r\n    const analyticsKey = `analytics_${shortCode}_${Date.now()}`;\r\n    await env.ANALYTICS_KV.put(analyticsKey, JSON.stringify({\r\n      shortCode,\r\n      timestamp: new Date().toISOString(),\r\n      userAgent: request.headers.get('User-Agent'),\r\n      referer: request.headers.get('Referer'),\r\n      ip: request.headers.get('CF-Connecting-IP'),\r\n    }), { expirationTtl: 31536000 }); // 1 year\r\n\r\n    // Update user's URL list click count\r\n    const userUrlsKey = `user_urls_${urlData.userId}`;\r\n    const userUrls = await env.URL_KV.get(userUrlsKey, { type: 'json' }) || [];\r\n    const urlIndex = userUrls.findIndex(u => u.shortCode === shortCode);\r\n    if (urlIndex !== -1) {\r\n      userUrls[urlIndex].clickCount = urlData.clickCount;\r\n      await env.URL_KV.put(userUrlsKey, JSON.stringify(userUrls));\r\n    }\r\n\r\n    // Redirect to original URL\r\n    return Response.redirect(urlData.url, 302);\r\n  } catch (error) {\r\n    return new Response(JSON.stringify({\r\n      error: 'Failed to redirect',\r\n      message: error.message,\r\n    }), {\r\n      status: 500,\r\n      headers: { ...getCorsHeaders(env, request), 'Content-Type': 'application/json' },\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Get URL info\r\n * GET /api/info/:shortCode\r\n */\r\nasync function handleGetUrlInfo(request, env) {\r\n  try {\r\n    // Authenticate user\r\n    const auth = await authenticateRequest(request, env);\r\n    if (!auth.authenticated) {\r\n      return new Response(JSON.stringify({ error: auth.error }), {\r\n        status: auth.status,\r\n        headers: { ...getCorsHeaders(env, request), 'Content-Type': 'application/json' },\r\n      });\r\n    }\r\n\r\n    const url = new URL(request.url);\r\n    const shortCode = url.pathname.split('/').pop();\r\n\r\n    if (!shortCode) {\r\n      return new Response(JSON.stringify({ error: 'Short code required' }), {\r\n        status: 400,\r\n        headers: { ...getCorsHeaders(env, request), 'Content-Type': 'application/json' },\r\n      });\r\n    }\r\n\r\n    const urlKey = `url_${shortCode}`;\r\n    const urlDataStr = await env.URL_KV.get(urlKey);\r\n\r\n    if (!urlDataStr) {\r\n      return new Response(JSON.stringify({ error: 'Short URL not found' }), {\r\n        status: 404,\r\n        headers: { ...getCorsHeaders(env, request), 'Content-Type': 'application/json' },\r\n      });\r\n    }\r\n\r\n    const urlData = JSON.parse(urlDataStr);\r\n\r\n    // Check if user owns this URL\r\n    if (urlData.userId !== auth.userId) {\r\n      return new Response(JSON.stringify({ error: 'Unauthorized' }), {\r\n        status: 403,\r\n        headers: { ...getCorsHeaders(env, request), 'Content-Type': 'application/json' },\r\n      });\r\n    }\r\n\r\n    const requestUrl = new URL(request.url);\r\n    const baseUrl = `${requestUrl.protocol}//${requestUrl.host}`;\r\n    const shortUrl = `${baseUrl}/${shortCode}`;\r\n\r\n    return new Response(JSON.stringify({\r\n      success: true,\r\n      shortUrl,\r\n      shortCode,\r\n      originalUrl: urlData.url,\r\n      clickCount: urlData.clickCount || 0,\r\n      createdAt: urlData.createdAt,\r\n      expiresAt: urlData.expiresAt,\r\n    }), {\r\n      headers: { ...getCorsHeaders(env, request), 'Content-Type': 'application/json' },\r\n    });\r\n  } catch (error) {\r\n    return new Response(JSON.stringify({\r\n      error: 'Failed to get URL info',\r\n      message: error.message,\r\n    }), {\r\n      status: 500,\r\n      headers: { ...getCorsHeaders(env, request), 'Content-Type': 'application/json' },\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * List user's URLs\r\n * GET /api/list\r\n */\r\nasync function handleListUrls(request, env) {\r\n  try {\r\n    // Authenticate user\r\n    const auth = await authenticateRequest(request, env);\r\n    if (!auth.authenticated) {\r\n      return new Response(JSON.stringify({ error: auth.error }), {\r\n        status: auth.status,\r\n        headers: { ...getCorsHeaders(env, request), 'Content-Type': 'application/json' },\r\n      });\r\n    }\r\n\r\n    const userUrlsKey = `user_urls_${auth.userId}`;\r\n    const userUrls = await env.URL_KV.get(userUrlsKey, { type: 'json' }) || [];\r\n\r\n    const requestUrl = new URL(request.url);\r\n    const baseUrl = `${requestUrl.protocol}//${requestUrl.host}`;\r\n\r\n    // Enrich with full URLs\r\n    const enrichedUrls = userUrls.map(u => ({\r\n      ...u,\r\n      shortUrl: `${baseUrl}/${u.shortCode}`,\r\n    }));\r\n\r\n    return new Response(JSON.stringify({\r\n      success: true,\r\n      urls: enrichedUrls,\r\n      count: enrichedUrls.length,\r\n    }), {\r\n      headers: { ...getCorsHeaders(env, request), 'Content-Type': 'application/json' },\r\n    });\r\n  } catch (error) {\r\n    return new Response(JSON.stringify({\r\n      error: 'Failed to list URLs',\r\n      message: error.message,\r\n    }), {\r\n      status: 500,\r\n      headers: { ...getCorsHeaders(env, request), 'Content-Type': 'application/json' },\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Delete short URL\r\n * DELETE /api/delete/:shortCode\r\n */\r\nasync function handleDeleteUrl(request, env) {\r\n  try {\r\n    // Authenticate user\r\n    const auth = await authenticateRequest(request, env);\r\n    if (!auth.authenticated) {\r\n      return new Response(JSON.stringify({ error: auth.error }), {\r\n        status: auth.status,\r\n        headers: { ...getCorsHeaders(env, request), 'Content-Type': 'application/json' },\r\n      });\r\n    }\r\n\r\n    const url = new URL(request.url);\r\n    const shortCode = url.pathname.split('/').pop();\r\n\r\n    if (!shortCode) {\r\n      return new Response(JSON.stringify({ error: 'Short code required' }), {\r\n        status: 400,\r\n        headers: { ...getCorsHeaders(env, request), 'Content-Type': 'application/json' },\r\n      });\r\n    }\r\n\r\n    const urlKey = `url_${shortCode}`;\r\n    const urlDataStr = await env.URL_KV.get(urlKey);\r\n\r\n    if (!urlDataStr) {\r\n      return new Response(JSON.stringify({ error: 'Short URL not found' }), {\r\n        status: 404,\r\n        headers: { ...getCorsHeaders(env, request), 'Content-Type': 'application/json' },\r\n      });\r\n    }\r\n\r\n    const urlData = JSON.parse(urlDataStr);\r\n\r\n    // Check if user owns this URL\r\n    if (urlData.userId !== auth.userId) {\r\n      return new Response(JSON.stringify({ error: 'Unauthorized' }), {\r\n        status: 403,\r\n        headers: { ...getCorsHeaders(env, request), 'Content-Type': 'application/json' },\r\n      });\r\n    }\r\n\r\n    // Delete URL\r\n    await env.URL_KV.delete(urlKey);\r\n\r\n    // Remove from user's URL list\r\n    const userUrlsKey = `user_urls_${auth.userId}`;\r\n    const userUrls = await env.URL_KV.get(userUrlsKey, { type: 'json' }) || [];\r\n    const filtered = userUrls.filter(u => u.shortCode !== shortCode);\r\n    await env.URL_KV.put(userUrlsKey, JSON.stringify(filtered));\r\n\r\n    return new Response(JSON.stringify({\r\n      success: true,\r\n      message: 'Short URL deleted',\r\n    }), {\r\n      headers: { ...getCorsHeaders(env, request), 'Content-Type': 'application/json' },\r\n    });\r\n  } catch (error) {\r\n    return new Response(JSON.stringify({\r\n      error: 'Failed to delete URL',\r\n      message: error.message,\r\n    }), {\r\n      status: 500,\r\n      headers: { ...getCorsHeaders(env, request), 'Content-Type': 'application/json' },\r\n    });\r\n  }\r\n}\r\n\r\n/**\r\n * Health check\r\n * GET /health\r\n */\r\nasync function handleHealth() {\r\n  return new Response(JSON.stringify({\r\n    status: 'ok',\r\n    service: 'url-shortener',\r\n    timestamp: new Date().toISOString(),\r\n  }), {\r\n    headers: { 'Content-Type': 'application/json' },\r\n  });\r\n}\r\n\r\n// Embedded standalone.html content\r\n// This is automatically generated from standalone.html - do not edit manually\r\nconst STANDALONE_HTML = `<!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n    <meta charset=\"UTF-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n    <title>URL Shortener - Strixun</title>\r\n    <style>\r\n        * {\r\n            margin: 0;\r\n            padding: 0;\r\n            box-sizing: border-box;\r\n        }\r\n\r\n        :root {\r\n            /* Strixun Stream Suite Design System */\r\n            --bg: #1a1611;\r\n            --bg-dark: #0f0e0b;\r\n            --card: #252017;\r\n            --border: #3d3627;\r\n            --border-light: #4a4336;\r\n            \r\n            /* Brand Colors */\r\n            --accent: #edae49;\r\n            --accent-light: #f9df74;\r\n            --accent-dark: #c68214;\r\n            --accent2: #6495ed;\r\n            \r\n            /* Status Colors */\r\n            --success: #28a745;\r\n            --warning: #ffc107;\r\n            --danger: #ea2b1f;\r\n            --info: #6495ed;\r\n            \r\n            /* Text Colors */\r\n            --text: #f9f9f9;\r\n            --text-secondary: #b8b8b8;\r\n            --muted: #888;\r\n            \r\n            /* Legacy aliases for compatibility */\r\n            --primary: var(--accent);\r\n            --primary-hover: var(--accent-dark);\r\n            --secondary: var(--border);\r\n            --error: var(--danger);\r\n            --text-muted: var(--muted);\r\n            \r\n            --radius: 8px;\r\n            --shadow: 0 2px 8px rgba(0, 0, 0, 0.2);\r\n        }\r\n\r\n        body {\r\n            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;\r\n            background: var(--bg);\r\n            color: var(--text);\r\n            line-height: 1.6;\r\n            min-height: 100vh;\r\n            padding: 20px;\r\n            margin: 0;\r\n        }\r\n\r\n        .container {\r\n            max-width: 800px;\r\n            margin: 0 auto;\r\n        }\r\n\r\n        .header {\r\n            text-align: center;\r\n            margin-bottom: 40px;\r\n            padding: 20px 0;\r\n        }\r\n\r\n        .header h1 {\r\n            font-size: 2.5rem;\r\n            margin-bottom: 10px;\r\n            background: linear-gradient(135deg, var(--accent), var(--accent-light));\r\n            -webkit-background-clip: text;\r\n            -webkit-text-fill-color: transparent;\r\n            background-clip: text;\r\n        }\r\n\r\n        .header p {\r\n            color: var(--muted);\r\n            font-size: 1.1rem;\r\n        }\r\n\r\n        .card {\r\n            background: var(--card);\r\n            border: 1px solid var(--border);\r\n            border-radius: var(--radius);\r\n            padding: 30px;\r\n            margin-bottom: 20px;\r\n            box-shadow: var(--shadow);\r\n            transition: transform 0.2s, box-shadow 0.2s;\r\n            animation: slideUp 0.3s ease-out;\r\n        }\r\n\r\n        .card:hover {\r\n            transform: translateY(-2px);\r\n            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\r\n        }\r\n\r\n        .auth-section {\r\n            text-align: center;\r\n        }\r\n\r\n        .auth-section h2 {\r\n            margin-bottom: 20px;\r\n            font-size: 1.5rem;\r\n        }\r\n\r\n        .form-group {\r\n            margin-bottom: 20px;\r\n            text-align: left;\r\n        }\r\n\r\n        .form-group label {\r\n            display: block;\r\n            margin-bottom: 8px;\r\n            color: var(--text);\r\n            font-weight: 500;\r\n        }\r\n\r\n        .form-group input {\r\n            width: 100%;\r\n            padding: 8px 12px;\r\n            background: var(--bg-dark);\r\n            border: 1px solid var(--border);\r\n            border-radius: 6px;\r\n            color: var(--text);\r\n            font-size: 14px;\r\n            transition: border-color 0.2s, box-shadow 0.2s;\r\n        }\r\n\r\n        .form-group input:focus {\r\n            outline: none;\r\n            border-color: var(--accent);\r\n            box-shadow: 0 0 0 2px rgba(237, 174, 73, 0.2);\r\n        }\r\n\r\n        .form-group input::placeholder {\r\n            color: var(--muted);\r\n        }\r\n\r\n        .form-group small {\r\n            display: block;\r\n            margin-top: 6px;\r\n            color: var(--muted);\r\n            font-size: 0.875rem;\r\n        }\r\n\r\n        .btn {\r\n            position: relative;\r\n            padding: 12px 24px;\r\n            border: 3px solid;\r\n            border-radius: 0;\r\n            font-size: 1rem;\r\n            font-weight: 700;\r\n            text-transform: uppercase;\r\n            letter-spacing: 1px;\r\n            cursor: pointer;\r\n            transition: all 0.1s cubic-bezier(0.4, 0, 0.2, 1);\r\n            display: inline-block;\r\n            text-decoration: none;\r\n            overflow: hidden;\r\n        }\r\n\r\n        .btn-primary {\r\n            background: var(--accent);\r\n            border-color: var(--accent-dark);\r\n            color: #000;\r\n            box-shadow: 0 4px 0 var(--accent-dark);\r\n        }\r\n\r\n        .btn-primary:hover:not(:disabled) {\r\n            transform: translateY(-2px);\r\n            box-shadow: 0 6px 0 var(--accent-dark);\r\n        }\r\n\r\n        .btn-primary:active:not(:disabled) {\r\n            transform: translateY(2px);\r\n            box-shadow: 0 2px 0 var(--accent-dark);\r\n        }\r\n\r\n        .btn-secondary {\r\n            background: var(--border);\r\n            border-color: var(--border-light);\r\n            color: var(--text);\r\n            box-shadow: 0 4px 0 var(--border-light);\r\n        }\r\n\r\n        .btn-secondary:hover:not(:disabled) {\r\n            transform: translateY(-2px);\r\n            box-shadow: 0 6px 0 var(--border-light);\r\n            background: var(--border-light);\r\n        }\r\n\r\n        .btn-secondary:active:not(:disabled) {\r\n            transform: translateY(2px);\r\n            box-shadow: 0 2px 0 var(--border-light);\r\n        }\r\n\r\n        .btn-danger {\r\n            background: var(--danger);\r\n            border-color: #c01f1f;\r\n            color: white;\r\n            box-shadow: 0 4px 0 #c01f1f;\r\n        }\r\n\r\n        .btn-danger:hover:not(:disabled) {\r\n            transform: translateY(-2px);\r\n            box-shadow: 0 6px 0 #c01f1f;\r\n        }\r\n\r\n        .btn-danger:active:not(:disabled) {\r\n            transform: translateY(2px);\r\n            box-shadow: 0 2px 0 #c01f1f;\r\n        }\r\n\r\n        .btn:disabled {\r\n            opacity: 0.5;\r\n            cursor: not-allowed;\r\n            transform: none;\r\n        }\r\n\r\n        .btn:disabled:hover {\r\n            transform: none;\r\n        }\r\n\r\n        .btn:focus-visible {\r\n            outline: 3px solid var(--accent);\r\n            outline-offset: 2px;\r\n        }\r\n\r\n        .btn-group {\r\n            display: flex;\r\n            gap: 10px;\r\n            flex-wrap: wrap;\r\n        }\r\n\r\n        .user-info {\r\n            display: flex;\r\n            justify-content: space-between;\r\n            align-items: center;\r\n            margin-bottom: 20px;\r\n            padding-bottom: 20px;\r\n            border-bottom: 1px solid var(--border);\r\n        }\r\n\r\n        .user-info span {\r\n            color: var(--muted);\r\n        }\r\n\r\n        .create-section h2 {\r\n            margin-bottom: 20px;\r\n            font-size: 1.5rem;\r\n        }\r\n\r\n        .urls-section h2 {\r\n            margin-bottom: 20px;\r\n            font-size: 1.5rem;\r\n        }\r\n\r\n        .url-card {\r\n            background: var(--bg-dark);\r\n            border: 1px solid var(--border);\r\n            border-radius: var(--radius);\r\n            padding: 20px;\r\n            margin-bottom: 15px;\r\n            transition: transform 0.2s, box-shadow 0.2s;\r\n            animation: fadeIn 0.3s ease-out;\r\n        }\r\n\r\n        .url-card:hover {\r\n            transform: translateY(-2px);\r\n            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\r\n            border-color: var(--border-light);\r\n        }\r\n\r\n        .url-card-header {\r\n            display: flex;\r\n            justify-content: space-between;\r\n            align-items: flex-start;\r\n            margin-bottom: 12px;\r\n        }\r\n\r\n        .url-short {\r\n            display: flex;\r\n            align-items: center;\r\n            gap: 10px;\r\n            flex: 1;\r\n        }\r\n\r\n        .url-short strong {\r\n            color: var(--accent);\r\n            font-size: 1.1rem;\r\n            word-break: break-all;\r\n        }\r\n\r\n        .btn-copy {\r\n            padding: 6px 12px;\r\n            background: var(--border);\r\n            border: 2px solid var(--border-light);\r\n            border-radius: 0;\r\n            color: var(--text);\r\n            cursor: pointer;\r\n            font-size: 0.875rem;\r\n            font-weight: 600;\r\n            text-transform: uppercase;\r\n            letter-spacing: 0.5px;\r\n            transition: all 0.1s;\r\n            box-shadow: 0 2px 0 var(--border-light);\r\n        }\r\n\r\n        .btn-copy:hover {\r\n            transform: translateY(-1px);\r\n            box-shadow: 0 3px 0 var(--border-light);\r\n            background: var(--border-light);\r\n        }\r\n\r\n        .btn-copy:active {\r\n            transform: translateY(1px);\r\n            box-shadow: 0 1px 0 var(--border-light);\r\n        }\r\n\r\n        .url-original {\r\n            margin-bottom: 12px;\r\n        }\r\n\r\n        .url-original a {\r\n            color: var(--muted);\r\n            text-decoration: none;\r\n            font-size: 0.9rem;\r\n            word-break: break-all;\r\n        }\r\n\r\n        .url-original a:hover {\r\n            color: var(--accent);\r\n            text-decoration: underline;\r\n        }\r\n\r\n        .url-meta {\r\n            display: flex;\r\n            gap: 15px;\r\n            color: var(--muted);\r\n            font-size: 0.875rem;\r\n            flex-wrap: wrap;\r\n        }\r\n\r\n        .empty-state {\r\n            text-align: center;\r\n            padding: 40px 20px;\r\n            color: var(--muted);\r\n            font-style: italic;\r\n            background: var(--bg-dark);\r\n            border-radius: 6px;\r\n            border: 1px dashed var(--border);\r\n        }\r\n\r\n        .loading {\r\n            text-align: center;\r\n            padding: 20px;\r\n            color: var(--muted);\r\n        }\r\n\r\n        .toast {\r\n            position: fixed;\r\n            bottom: 20px;\r\n            right: 20px;\r\n            background: var(--card);\r\n            border: 1px solid var(--border);\r\n            border-radius: var(--radius);\r\n            padding: 16px 20px;\r\n            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.4);\r\n            z-index: 10000;\r\n            max-width: 400px;\r\n            animation: slideIn 0.3s ease-out;\r\n        }\r\n\r\n        .toast.success {\r\n            border-left: 4px solid var(--success);\r\n        }\r\n\r\n        .toast.error {\r\n            border-left: 4px solid var(--danger);\r\n        }\r\n\r\n        .toast.warning {\r\n            border-left: 4px solid var(--warning);\r\n        }\r\n\r\n        @keyframes slideIn {\r\n            from {\r\n                transform: translateX(100%);\r\n                opacity: 0;\r\n            }\r\n            to {\r\n                transform: translateX(0);\r\n                opacity: 1;\r\n            }\r\n        }\r\n\r\n        @keyframes fadeIn {\r\n            from {\r\n                opacity: 0;\r\n            }\r\n            to {\r\n                opacity: 1;\r\n            }\r\n        }\r\n\r\n        @keyframes slideUp {\r\n            from {\r\n                transform: translateY(20px);\r\n                opacity: 0;\r\n            }\r\n            to {\r\n                transform: translateY(0);\r\n                opacity: 1;\r\n            }\r\n        }\r\n\r\n        .otp-input-group {\r\n            display: flex;\r\n            gap: 10px;\r\n            align-items: center;\r\n        }\r\n\r\n        .otp-input {\r\n            flex: 1;\r\n        }\r\n\r\n        .otp-resend {\r\n            white-space: nowrap;\r\n        }\r\n\r\n        .otp-timer {\r\n            color: var(--muted);\r\n            font-size: 0.875rem;\r\n            margin-top: 8px;\r\n        }\r\n\r\n        @media (max-width: 600px) {\r\n            .header h1 {\r\n                font-size: 2rem;\r\n            }\r\n\r\n            .card {\r\n                padding: 20px;\r\n            }\r\n\r\n            .user-info {\r\n                flex-direction: column;\r\n                align-items: flex-start;\r\n                gap: 10px;\r\n            }\r\n\r\n            .url-card-header {\r\n                flex-direction: column;\r\n                gap: 10px;\r\n            }\r\n\r\n            .btn-group {\r\n                width: 100%;\r\n            }\r\n\r\n            .btn-group .btn {\r\n                flex: 1;\r\n            }\r\n        }\r\n    </style>\r\n</head>\r\n<body>\r\n    <div class=\"container\">\r\n        <div class=\"header\">\r\n            <h1>\uD83D\uDD17 URL Shortener</h1>\r\n            <p>Create and manage short URLs with OTP authentication</p>\r\n        </div>\r\n\r\n        <!-- Authentication Section -->\r\n        <div id=\"authSection\" class=\"card auth-section\">\r\n            <h2>Sign In</h2>\r\n            <div id=\"authStep1\">\r\n                <div class=\"form-group\">\r\n                    <label for=\"emailInput\">Email Address</label>\r\n                    <input \r\n                        type=\"email\" \r\n                        id=\"emailInput\" \r\n                        placeholder=\"your@email.com\"\r\n                        autocomplete=\"email\"\r\n                    >\r\n                </div>\r\n                <button class=\"btn btn-primary\" onclick=\"requestOTP()\">\r\n                    Send OTP Code\r\n                </button>\r\n            </div>\r\n            <div id=\"authStep2\" style=\"display: none;\">\r\n                <div class=\"form-group\">\r\n                    <label for=\"otpInput\">Enter 6-digit OTP Code</label>\r\n                    <div class=\"otp-input-group\">\r\n                        <input \r\n                            type=\"text\" \r\n                            id=\"otpInput\" \r\n                            placeholder=\"000000\"\r\n                            maxlength=\"6\"\r\n                            pattern=\"[0-9]{6}\"\r\n                            class=\"otp-input\"\r\n                            onkeypress=\"return /[0-9]/.test(event.key)\"\r\n                            oninput=\"this.value = this.value.replace(/[^0-9]/g, '')\"\r\n                        >\r\n                        <button class=\"btn btn-secondary otp-resend\" onclick=\"requestOTP()\" id=\"resendBtn\">\r\n                            Resend\r\n                        </button>\r\n                    </div>\r\n                    <small>Check your email for the 6-digit code</small>\r\n                    <div id=\"otpTimer\" class=\"otp-timer\"></div>\r\n                </div>\r\n                <div class=\"btn-group\">\r\n                    <button class=\"btn btn-primary\" onclick=\"verifyOTP()\">\r\n                        Verify & Sign In\r\n                    </button>\r\n                    <button class=\"btn btn-secondary\" onclick=\"backToEmail()\">\r\n                        Back\r\n                    </button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n\r\n        <!-- Main App Section -->\r\n        <div id=\"appSection\" style=\"display: none;\">\r\n            <div class=\"card\">\r\n                <div class=\"user-info\">\r\n                    <div>\r\n                        <strong>Signed in as:</strong> <span id=\"userEmail\"></span>\r\n                    </div>\r\n                    <button class=\"btn btn-secondary\" onclick=\"logout()\">\r\n                        Sign Out\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            <!-- Create URL Section -->\r\n            <div class=\"card create-section\">\r\n                <h2>Create Short URL</h2>\r\n                <div class=\"form-group\">\r\n                    <label for=\"urlInput\">URL to shorten</label>\r\n                    <input \r\n                        type=\"url\" \r\n                        id=\"urlInput\" \r\n                        placeholder=\"https://example.com/very/long/url\"\r\n                        autocomplete=\"off\"\r\n                    >\r\n                </div>\r\n                <div class=\"form-group\">\r\n                    <label for=\"customCodeInput\">Custom code (optional)</label>\r\n                    <input \r\n                        type=\"text\" \r\n                        id=\"customCodeInput\" \r\n                        placeholder=\"mycode\"\r\n                        pattern=\"[a-zA-Z0-9_-]{3,20}\"\r\n                        autocomplete=\"off\"\r\n                    >\r\n                    <small>3-20 characters, letters, numbers, hyphens, and underscores only</small>\r\n                </div>\r\n                <button class=\"btn btn-primary\" onclick=\"createShortUrl()\" id=\"createBtn\">\r\n                    Create Short URL\r\n                </button>\r\n            </div>\r\n\r\n            <!-- URLs List Section -->\r\n            <div class=\"card urls-section\">\r\n                <div style=\"display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;\">\r\n                    <h2 style=\"margin: 0;\">Your Short URLs</h2>\r\n                    <button class=\"btn btn-secondary\" onclick=\"loadUrls()\" id=\"refreshBtn\">\r\n                        \uD83D\uDD04 Refresh\r\n                    </button>\r\n                </div>\r\n                <div id=\"urlsList\">\r\n                    <div class=\"loading\">Loading URLs...</div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n\r\n    <script>\r\n        // Configuration - Using custom domain (s.idling.app)\r\n        const OTP_AUTH_API_URL = 'https://otp-auth-service.strixuns-script-suite.workers.dev';\r\n        const URL_SHORTENER_API_URL = 'https://s.idling.app';\r\n\r\n        // State\r\n        let authToken = null;\r\n        let userEmail = null;\r\n        let otpTimer = null;\r\n        let otpTimerInterval = null;\r\n\r\n        // Initialize\r\n        window.addEventListener('DOMContentLoaded', () => {\r\n            // Check for stored token\r\n            const storedToken = localStorage.getItem('urlShortenerToken');\r\n            const storedEmail = localStorage.getItem('urlShortenerEmail');\r\n            \r\n            if (storedToken && storedEmail) {\r\n                authToken = storedToken;\r\n                userEmail = storedEmail;\r\n                showApp();\r\n            } else {\r\n                showAuth();\r\n            }\r\n        });\r\n\r\n        // Authentication Functions\r\n        async function requestOTP() {\r\n            const email = document.getElementById('emailInput').value.trim();\r\n            \r\n            if (!email || !/^[^\\\\s@]+@[^\\\\s@]+\\\\.[^\\\\s@]+$/.test(email)) {\r\n                showToast('Please enter a valid email address', 'error');\r\n                return;\r\n            }\r\n\r\n            const resendBtn = document.getElementById('resendBtn');\r\n            resendBtn.disabled = true;\r\n\r\n            try {\r\n                const response = await fetch(\\`\\${OTP_AUTH_API_URL}/auth/request-otp\\`, {\r\n                    method: 'POST',\r\n                    headers: {\r\n                        'Content-Type': 'application/json',\r\n                    },\r\n                    body: JSON.stringify({ email }),\r\n                });\r\n\r\n                const data = await response.json();\r\n\r\n                if (response.ok) {\r\n                    showToast('OTP code sent to your email!', 'success');\r\n                    document.getElementById('authStep1').style.display = 'none';\r\n                    document.getElementById('authStep2').style.display = 'block';\r\n                    document.getElementById('otpInput').focus();\r\n                    \r\n                    // Start OTP timer (10 minutes)\r\n                    startOTPTimer();\r\n                } else {\r\n                    // Handle both old format (data.error) and RFC 7807 format (data.detail)\r\n                    const errorMessage = data.detail || data.error || 'Failed to send OTP';\r\n                    showToast(errorMessage, 'error');\r\n                    resendBtn.disabled = false;\r\n                }\r\n            } catch (error) {\r\n                showToast('Network error. Please try again.', 'error');\r\n                resendBtn.disabled = false;\r\n            }\r\n        }\r\n\r\n        async function verifyOTP() {\r\n            const email = document.getElementById('emailInput').value.trim();\r\n            const otp = document.getElementById('otpInput').value.trim();\r\n\r\n            if (!otp || !/^\\\\d{6}$/.test(otp)) {\r\n                showToast('Please enter a valid 6-digit OTP code', 'error');\r\n                return;\r\n            }\r\n\r\n            const verifyBtn = event.target;\r\n            verifyBtn.disabled = true;\r\n            verifyBtn.textContent = 'Verifying...';\r\n\r\n            try {\r\n                const response = await fetch(\\`\\${OTP_AUTH_API_URL}/auth/verify-otp\\`, {\r\n                    method: 'POST',\r\n                    headers: {\r\n                        'Content-Type': 'application/json',\r\n                    },\r\n                    body: JSON.stringify({ email, otp }),\r\n                });\r\n\r\n                const data = await response.json();\r\n\r\n                if (response.ok && (data.token || data.access_token)) {\r\n                    // Support both old format (token) and OAuth 2.0 format (access_token)\r\n                    authToken = data.access_token || data.token;\r\n                    userEmail = data.email || email;\r\n                    \r\n                    // Store token\r\n                    localStorage.setItem('urlShortenerToken', authToken);\r\n                    localStorage.setItem('urlShortenerEmail', userEmail);\r\n                    \r\n                    showToast('Successfully signed in!', 'success');\r\n                    stopOTPTimer();\r\n                    showApp();\r\n                } else {\r\n                    // Handle both old format (data.error) and RFC 7807 format (data.detail)\r\n                    const errorMessage = data.detail || data.error || 'Invalid OTP code';\r\n                    showToast(errorMessage, 'error');\r\n                    verifyBtn.disabled = false;\r\n                    verifyBtn.textContent = 'Verify & Sign In';\r\n                    \r\n                    // Support both old and new format for remaining attempts\r\n                    const remainingAttempts = data.remaining_attempts || data.remainingAttempts;\r\n                    if (remainingAttempts !== undefined) {\r\n                        showToast(\\`Remaining attempts: \\${remainingAttempts}\\`, 'warning');\r\n                    }\r\n                }\r\n            } catch (error) {\r\n                showToast('Network error. Please try again.', 'error');\r\n                verifyBtn.disabled = false;\r\n                verifyBtn.textContent = 'Verify & Sign In';\r\n            }\r\n        }\r\n\r\n        function backToEmail() {\r\n            document.getElementById('authStep1').style.display = 'block';\r\n            document.getElementById('authStep2').style.display = 'none';\r\n            document.getElementById('otpInput').value = '';\r\n            stopOTPTimer();\r\n        }\r\n\r\n        function logout() {\r\n            authToken = null;\r\n            userEmail = null;\r\n            localStorage.removeItem('urlShortenerToken');\r\n            localStorage.removeItem('urlShortenerEmail');\r\n            showAuth();\r\n            showToast('Signed out successfully', 'success');\r\n        }\r\n\r\n        function showAuth() {\r\n            document.getElementById('authSection').style.display = 'block';\r\n            document.getElementById('appSection').style.display = 'none';\r\n            document.getElementById('emailInput').value = '';\r\n            document.getElementById('otpInput').value = '';\r\n            backToEmail();\r\n        }\r\n\r\n        function showApp() {\r\n            document.getElementById('authSection').style.display = 'none';\r\n            document.getElementById('appSection').style.display = 'block';\r\n            document.getElementById('userEmail').textContent = userEmail;\r\n            loadUrls();\r\n        }\r\n\r\n        // OTP Timer\r\n        function startOTPTimer() {\r\n            let timeLeft = 600; // 10 minutes in seconds\r\n            const timerEl = document.getElementById('otpTimer');\r\n            const resendBtn = document.getElementById('resendBtn');\r\n            \r\n            otpTimerInterval = setInterval(() => {\r\n                const minutes = Math.floor(timeLeft / 60);\r\n                const seconds = timeLeft % 60;\r\n                timerEl.textContent = \\`Code expires in \\${minutes}:\\${seconds.toString().padStart(2, '0')}\\`;\r\n                \r\n                timeLeft--;\r\n                \r\n                if (timeLeft < 0) {\r\n                    stopOTPTimer();\r\n                    timerEl.textContent = 'OTP code expired. Please request a new one.';\r\n                    resendBtn.disabled = false;\r\n                }\r\n            }, 1000);\r\n        }\r\n\r\n        function stopOTPTimer() {\r\n            if (otpTimerInterval) {\r\n                clearInterval(otpTimerInterval);\r\n                otpTimerInterval = null;\r\n            }\r\n            document.getElementById('otpTimer').textContent = '';\r\n            document.getElementById('resendBtn').disabled = false;\r\n        }\r\n\r\n        // URL Shortener Functions\r\n        async function createShortUrl() {\r\n            const url = document.getElementById('urlInput').value.trim();\r\n            const customCode = document.getElementById('customCodeInput').value.trim();\r\n\r\n            if (!url) {\r\n                showToast('Please enter a URL to shorten', 'error');\r\n                return;\r\n            }\r\n\r\n            if (!isValidUrl(url)) {\r\n                showToast('Please enter a valid URL (must start with http:// or https://)', 'error');\r\n                return;\r\n            }\r\n\r\n            if (customCode && !/^[a-zA-Z0-9_-]{3,20}$/.test(customCode)) {\r\n                showToast('Custom code must be 3-20 characters and contain only letters, numbers, hyphens, and underscores', 'error');\r\n                return;\r\n            }\r\n\r\n            const createBtn = document.getElementById('createBtn');\r\n            createBtn.disabled = true;\r\n            createBtn.textContent = 'Creating...';\r\n\r\n            try {\r\n                const response = await fetch(\\`\\${URL_SHORTENER_API_URL}/api/create\\`, {\r\n                    method: 'POST',\r\n                    headers: {\r\n                        'Content-Type': 'application/json',\r\n                        'Authorization': \\`Bearer \\${authToken}\\`,\r\n                    },\r\n                    body: JSON.stringify({\r\n                        url,\r\n                        customCode: customCode || undefined,\r\n                    }),\r\n                });\r\n\r\n                const data = await response.json();\r\n\r\n                if (response.ok && data.success) {\r\n                    showToast(\\`Short URL created: \\${data.shortUrl}\\`, 'success');\r\n                    document.getElementById('urlInput').value = '';\r\n                    document.getElementById('customCodeInput').value = '';\r\n                    loadUrls();\r\n                } else {\r\n                    showToast(data.error || 'Failed to create short URL', 'error');\r\n                }\r\n            } catch (error) {\r\n                showToast('Network error. Please try again.', 'error');\r\n            } finally {\r\n                createBtn.disabled = false;\r\n                createBtn.textContent = 'Create Short URL';\r\n            }\r\n        }\r\n\r\n        async function loadUrls() {\r\n            const urlsList = document.getElementById('urlsList');\r\n            const refreshBtn = document.getElementById('refreshBtn');\r\n            \r\n            urlsList.innerHTML = '<div class=\"loading\">Loading URLs...</div>';\r\n            refreshBtn.disabled = true;\r\n\r\n            try {\r\n                const response = await fetch(\\`\\${URL_SHORTENER_API_URL}/api/list\\`, {\r\n                    headers: {\r\n                        'Authorization': \\`Bearer \\${authToken}\\`,\r\n                    },\r\n                });\r\n\r\n                const data = await response.json();\r\n\r\n                if (response.ok && data.success) {\r\n                    if (data.urls && data.urls.length > 0) {\r\n                        urlsList.innerHTML = data.urls.map(url => \\`\r\n                            <div class=\"url-card\">\r\n                                <div class=\"url-card-header\">\r\n                                    <div class=\"url-short\">\r\n                                        <strong>\\${escapeHtml(url.shortUrl)}</strong>\r\n                                        <button class=\"btn-copy\" onclick=\"copyToClipboard('\\${escapeHtml(url.shortUrl)}')\" title=\"Copy to clipboard\">\r\n                                            \uD83D\uDCCB Copy\r\n                                        </button>\r\n                                    </div>\r\n                                    <button class=\"btn btn-danger\" onclick=\"deleteUrl('\\${escapeHtml(url.shortCode)}')\" title=\"Delete\">\r\n                                        \uD83D\uDDD1\uFE0F Delete\r\n                                    </button>\r\n                                </div>\r\n                                <div class=\"url-original\">\r\n                                    <a href=\"\\${escapeHtml(url.url)}\" target=\"_blank\" rel=\"noopener noreferrer\">\r\n                                        \\${escapeHtml(url.url)}\r\n                                    </a>\r\n                                </div>\r\n                                <div class=\"url-meta\">\r\n                                    <span>Created: \\${new Date(url.createdAt).toLocaleDateString()}</span>\r\n                                    <span>\u2022</span>\r\n                                    <span>Clicks: \\${url.clickCount || 0}</span>\r\n                                </div>\r\n                            </div>\r\n                        \\`).join('');\r\n                    } else {\r\n                        urlsList.innerHTML = '<div class=\"empty-state\">No short URLs yet. Create your first one above!</div>';\r\n                    }\r\n                } else {\r\n                    if (response.status === 401) {\r\n                        showToast('Session expired. Please sign in again.', 'error');\r\n                        logout();\r\n                    } else {\r\n                        showToast(data.error || 'Failed to load URLs', 'error');\r\n                        urlsList.innerHTML = '<div class=\"empty-state\">Failed to load URLs</div>';\r\n                    }\r\n                }\r\n            } catch (error) {\r\n                showToast('Network error. Please try again.', 'error');\r\n                urlsList.innerHTML = '<div class=\"empty-state\">Network error</div>';\r\n            } finally {\r\n                refreshBtn.disabled = false;\r\n            }\r\n        }\r\n\r\n        async function deleteUrl(shortCode) {\r\n            if (!confirm('Are you sure you want to delete this short URL?')) {\r\n                return;\r\n            }\r\n\r\n            try {\r\n                const response = await fetch(\\`\\${URL_SHORTENER_API_URL}/api/delete/\\${shortCode}\\`, {\r\n                    method: 'DELETE',\r\n                    headers: {\r\n                        'Authorization': \\`Bearer \\${authToken}\\`,\r\n                    },\r\n                });\r\n\r\n                const data = await response.json();\r\n\r\n                if (response.ok && data.success) {\r\n                    showToast('Short URL deleted successfully', 'success');\r\n                    loadUrls();\r\n                } else {\r\n                    if (response.status === 401) {\r\n                        showToast('Session expired. Please sign in again.', 'error');\r\n                        logout();\r\n                    } else {\r\n                        showToast(data.error || 'Failed to delete URL', 'error');\r\n                    }\r\n                }\r\n            } catch (error) {\r\n                showToast('Network error. Please try again.', 'error');\r\n            }\r\n        }\r\n\r\n        // Utility Functions\r\n        function isValidUrl(url) {\r\n            try {\r\n                const urlObj = new URL(url);\r\n                return urlObj.protocol === 'http:' || urlObj.protocol === 'https:';\r\n            } catch {\r\n                return false;\r\n            }\r\n        }\r\n\r\n        async function copyToClipboard(text) {\r\n            try {\r\n                await navigator.clipboard.writeText(text);\r\n                showToast('Copied to clipboard!', 'success');\r\n            } catch (error) {\r\n                // Fallback for older browsers\r\n                const textarea = document.createElement('textarea');\r\n                textarea.value = text;\r\n                textarea.style.position = 'fixed';\r\n                textarea.style.opacity = '0';\r\n                document.body.appendChild(textarea);\r\n                textarea.select();\r\n                try {\r\n                    document.execCommand('copy');\r\n                    showToast('Copied to clipboard!', 'success');\r\n                } catch (err) {\r\n                    showToast('Failed to copy to clipboard', 'error');\r\n                }\r\n                document.body.removeChild(textarea);\r\n            }\r\n        }\r\n\r\n        function escapeHtml(text) {\r\n            const div = document.createElement('div');\r\n            div.textContent = text;\r\n            return div.innerHTML;\r\n        }\r\n\r\n        function showToast(message, type = 'success') {\r\n            const toast = document.createElement('div');\r\n            toast.className = \\`toast \\${type}\\`;\r\n            toast.textContent = message;\r\n            document.body.appendChild(toast);\r\n\r\n            setTimeout(() => {\r\n                toast.style.animation = 'slideIn 0.3s ease-out reverse';\r\n                setTimeout(() => {\r\n                    document.body.removeChild(toast);\r\n                }, 300);\r\n            }, 3000);\r\n        }\r\n\r\n        // Allow Enter key to submit forms\r\n        document.addEventListener('keypress', (e) => {\r\n            if (e.key === 'Enter') {\r\n                if (document.getElementById('emailInput') === document.activeElement) {\r\n                    requestOTP();\r\n                } else if (document.getElementById('otpInput') === document.activeElement) {\r\n                    verifyOTP();\r\n                } else if (document.getElementById('urlInput') === document.activeElement) {\r\n                    createShortUrl();\r\n                }\r\n            }\r\n        });\r\n    </script>\r\n</body>\r\n</html>`;\r\n\r\n/**\r\n * Serve standalone HTML page\r\n * GET /\r\n * \r\n * Note: The HTML is embedded directly in the worker for simplicity.\r\n * For production, consider using Workers Assets or a separate static hosting solution.\r\n */\r\nfunction handleStandalonePage() {\r\n  // HTML content is embedded above - this is the standalone.html file content\r\n  const html = STANDALONE_HTML;\r\n  \r\n  return new Response(html, {\r\n    headers: { \r\n      'Content-Type': 'text/html; charset=utf-8',\r\n      'Cache-Control': 'public, max-age=3600',\r\n    },\r\n  });\r\n}\r\n\r\n/**\r\n * Main request handler\r\n */\r\nexport default {\r\n  async fetch(request, env, ctx) {\r\n    // Handle CORS preflight\r\n    if (request.method === 'OPTIONS') {\r\n      return new Response(null, { headers: getCorsHeaders(env, request) });\r\n    }\r\n\r\n    const url = new URL(request.url);\r\n    const path = url.pathname;\r\n\r\n    try {\r\n      // Health check (moved before root to ensure it works)\r\n      if (path === '/health') {\r\n        return handleHealth();\r\n      }\r\n\r\n      // Serve standalone HTML page at root\r\n      if (path === '/' && request.method === 'GET') {\r\n        return handleStandalonePage();\r\n      }\r\n\r\n      // API endpoints (require authentication)\r\n      if (path === '/api/create' && request.method === 'POST') {\r\n        return handleCreateShortUrl(request, env);\r\n      }\r\n\r\n      if (path.startsWith('/api/info/') && request.method === 'GET') {\r\n        return handleGetUrlInfo(request, env);\r\n      }\r\n\r\n      if (path === '/api/list' && request.method === 'GET') {\r\n        return handleListUrls(request, env);\r\n      }\r\n\r\n      if (path.startsWith('/api/delete/') && request.method === 'DELETE') {\r\n        return handleDeleteUrl(request, env);\r\n      }\r\n\r\n      // Redirect endpoint (public, no auth required)\r\n      // This must be last to catch all other paths\r\n      if (request.method === 'GET' && path !== '/api' && !path.startsWith('/api/')) {\r\n        return handleRedirect(request, env);\r\n      }\r\n\r\n      // Not found\r\n      return new Response(JSON.stringify({ error: 'Not found' }), {\r\n        status: 404,\r\n        headers: { ...getCorsHeaders(env, request), 'Content-Type': 'application/json' },\r\n      });\r\n    } catch (error) {\r\n      return new Response(JSON.stringify({\r\n        error: 'Internal server error',\r\n        message: error.message,\r\n      }), {\r\n        status: 500,\r\n        headers: { ...getCorsHeaders(env, request), 'Content-Type': 'application/json' },\r\n      });\r\n    }\r\n  },\r\n};\r\n\r\n"],
  "mappings": "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AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAg+BxB,SAAS,uBAAuB;AAE9B,QAAM,OAAO;AAEb,SAAO,IAAI,SAAS,MAAM;AAAA,IACxB,SAAS;AAAA,MACP,gBAAgB;AAAA,MAChB,iBAAiB;AAAA,IACnB;AAAA,EACF,CAAC;AACH;AAVS;AAeT,IAAO,iBAAQ;AAAA,EACb,MAAM,MAAM,SAAS,KAAK,KAAK;AAE7B,QAAI,QAAQ,WAAW,WAAW;AAChC,aAAO,IAAI,SAAS,MAAM,EAAE,SAAS,eAAe,KAAK,OAAO,EAAE,CAAC;AAAA,IACrE;AAEA,UAAM,MAAM,IAAI,IAAI,QAAQ,GAAG;AAC/B,UAAM,OAAO,IAAI;AAEjB,QAAI;AAEF,UAAI,SAAS,WAAW;AACtB,eAAO,aAAa;AAAA,MACtB;AAGA,UAAI,SAAS,OAAO,QAAQ,WAAW,OAAO;AAC5C,eAAO,qBAAqB;AAAA,MAC9B;AAGA,UAAI,SAAS,iBAAiB,QAAQ,WAAW,QAAQ;AACvD,eAAO,qBAAqB,SAAS,GAAG;AAAA,MAC1C;AAEA,UAAI,KAAK,WAAW,YAAY,KAAK,QAAQ,WAAW,OAAO;AAC7D,eAAO,iBAAiB,SAAS,GAAG;AAAA,MACtC;AAEA,UAAI,SAAS,eAAe,QAAQ,WAAW,OAAO;AACpD,eAAO,eAAe,SAAS,GAAG;AAAA,MACpC;AAEA,UAAI,KAAK,WAAW,cAAc,KAAK,QAAQ,WAAW,UAAU;AAClE,eAAO,gBAAgB,SAAS,GAAG;AAAA,MACrC;AAIA,UAAI,QAAQ,WAAW,SAAS,SAAS,UAAU,CAAC,KAAK,WAAW,OAAO,GAAG;AAC5E,eAAO,eAAe,SAAS,GAAG;AAAA,MACpC;AAGA,aAAO,IAAI,SAAS,KAAK,UAAU,EAAE,OAAO,YAAY,CAAC,GAAG;AAAA,QAC1D,QAAQ;AAAA,QACR,SAAS,EAAE,GAAG,eAAe,KAAK,OAAO,GAAG,gBAAgB,mBAAmB;AAAA,MACjF,CAAC;AAAA,IACH,SAAS,OAAO;AACd,aAAO,IAAI,SAAS,KAAK,UAAU;AAAA,QACjC,OAAO;AAAA,QACP,SAAS,MAAM;AAAA,MACjB,CAAC,GAAG;AAAA,QACF,QAAQ;AAAA,QACR,SAAS,EAAE,GAAG,eAAe,KAAK,OAAO,GAAG,gBAAgB,mBAAmB;AAAA,MACjF,CAAC;AAAA,IACH;AAAA,EACF;AACF;",
  "names": []
}
