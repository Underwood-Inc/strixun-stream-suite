/**
 * Bundle HTML Template
 * 
 * Bundles the plain HTML template into a TypeScript constant for the worker
 */

import { readFileSync, writeFileSync } from 'fs';
import { join, dirname } from 'path';
import { fileURLToPath } from 'url';

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

const projectRoot = join(__dirname, '..');
const templatePath = join(projectRoot, 'templates', 'index.html');
const outputPath = join(projectRoot, 'dist', 'html-template.ts');

try {
  console.log('Bundling HTML template...');
  
  const html = readFileSync(templatePath, 'utf-8');
  
  const output = `/**
 * URL Shortener HTML Template
 * 
 * This file is auto-generated by scripts/bundle-html.js
 * Do not edit manually
 */

export const HTML_TEMPLATE = ${JSON.stringify(html)};
`;
  
  // Ensure dist directory exists
  const { mkdirSync } = await import('fs');
  try {
    mkdirSync(join(projectRoot, 'dist'), { recursive: true });
  } catch (err) {
    // Directory might already exist, ignore
  }
  
  writeFileSync(outputPath, output);
  console.log(`✓ Bundled HTML template to ${outputPath}`);
} catch (error) {
  console.error('✗ Failed to bundle HTML template:', error);
  process.exit(1);
}

