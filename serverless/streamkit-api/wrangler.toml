# Streamkit API Service - Cloudflare Worker Configuration
# Dedicated worker for Streamkit cloud storage (text cyclers, swaps, layouts, notes, scene activity)

name = "strixun-streamkit-api"
main = "dist/worker.js"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]

# Environment variables (secrets should be set via wrangler secret put)
# DO NOT put actual secrets here - use wrangler CLI:
#   wrangler secret put JWT_SECRET                   # REQUIRED: JWT signing secret (must match OTP auth service)
#   wrangler secret put ALLOWED_ORIGINS              # OPTIONAL: Comma-separated CORS origins (recommended for production)
#   wrangler secret put SERVICE_API_KEY              # OPTIONAL: Service API key for service-to-service auth
#   wrangler secret put NETWORK_INTEGRITY_KEYPHRASE  # OPTIONAL: Network integrity verification keyphrase
#
# IMPORTANT: 
#   - JWT_SECRET must match the OTP auth service secret for authentication to work

# Development environment (only used with --env development)
[env.development]
vars = { ENVIRONMENT = "development", JWT_ISSUER = "http://localhost:8787", NETWORK_INTEGRITY_KEYPHRASE = "test-integrity-keyphrase-for-local-development", JWT_SECRET = "dev-jwt-secret-do-not-use-in-production-abc123", SERVICE_API_KEY = "dev-service-api-key-for-local-testing", ALLOWED_ORIGINS = "http://localhost:3001,http://localhost:5173,http://localhost:5174,http://localhost:5175,http://localhost:5176,http://localhost:5178,http://localhost:5180,http://localhost:8787,http://localhost:3000" }

# Development KV Namespace
[[env.development.kv_namespaces]]
binding = "STREAMKIT_KV"
id = "a70d6c00bcc44a9ba9310c4590f228a8"

# Default configuration (production) - this is the ONLY production config for streamkit-api
# We use default deployment (wrangler deploy) NOT --env production
[vars]
ENVIRONMENT = "production"
JWT_ISSUER = "https://auth.idling.app"

# Default KV Namespace
[[kv_namespaces]]
binding = "STREAMKIT_KV"
id = "193c308cee734e1bb08bba03ae2d65b0"

# Default routes (production)
[[routes]]
pattern = "streamkit-api.idling.app/*"
zone_name = "idling.app"

# Observability Configuration
[observability]
enabled = true
head_sampling_rate = 1

[observability.logs]
enabled = true
head_sampling_rate = 1
persist = true
invocation_logs = true

[observability.traces]
enabled = false
persist = true
head_sampling_rate = 1
