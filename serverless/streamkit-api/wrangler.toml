# Streamkit API Service - Cloudflare Worker Configuration
# Dedicated worker for Streamkit cloud storage (text cyclers, swaps, layouts, notes, scene activity)

name = "strixun-streamkit-api"
main = "dist/worker.js"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]

# Default vars for LOCAL DEVELOPMENT (wrangler dev)
# Production secrets are set via wrangler secret put
[vars]
ENVIRONMENT = "development"
JWT_SECRET = "test-jwt-secret-for-local-development-12345678901234567890123456789012"
ALLOWED_ORIGINS = "http://localhost:5173,http://localhost:5175,http://localhost:5178,http://localhost:3001,http://localhost:8787"
NETWORK_INTEGRITY_KEYPHRASE = "test-integrity-keyphrase-for-integration-tests"
SERVICE_API_KEY = "test-service-key-12345"

# Default KV Namespace (used in local dev)
[[kv_namespaces]]
binding = "STREAMKIT_KV"
id = "193c308cee734e1bb08bba03ae2d65b0"

# Production environment
[env.production]
vars = { ENVIRONMENT = "production" }

[[env.production.kv_namespaces]]
binding = "STREAMKIT_KV"
id = "193c308cee734e1bb08bba03ae2d65b0"

[[env.production.routes]]
pattern = "streamkit-api.idling.app/*"
zone_name = "idling.app"

# Observability Configuration
[observability]
enabled = true
head_sampling_rate = 1

[observability.logs]
enabled = true
head_sampling_rate = 1
persist = true
invocation_logs = true

[observability.traces]
enabled = false
persist = true
head_sampling_rate = 1
