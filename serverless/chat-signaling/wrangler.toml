name = "strixun-chat-signaling"
main = "worker.ts"
compatibility_date = "2024-01-01"

# Production environment
[env.production]
vars = { ENVIRONMENT = "production" }

# Production KV Namespace
[[env.production.kv_namespaces]]
binding = "CHAT_KV"
id = "78a1bd4cd5dc468780de442aacc9d1ee"
preview_id = "78a1bd4cd5dc468780de442aacc9d1ee"

# Development environment
[env.development]
vars = { ENVIRONMENT = "development" }

# Development KV Namespace (using same namespace for testing)
[[env.development.kv_namespaces]]
binding = "CHAT_KV"
id = "78a1bd4cd5dc468780de442aacc9d1ee"
preview_id = "78a1bd4cd5dc468780de442aacc9d1ee"

# Default to production for backward compatibility
[vars]
ENVIRONMENT = "production"

# Note: Create KV namespace with:
# wrangler kv namespace create "CHAT_KV"
# Then update the IDs above

# Environment variables (secrets should be set via wrangler secret put)
# DO NOT put actual secrets here - use wrangler CLI:
#   wrangler secret put JWT_SECRET
#   IMPORTANT: Use the SAME JWT_SECRET as your OTP auth service for compatibility
#   This service validates JWT tokens created by the OTP auth service
#   wrangler secret put ALLOWED_ORIGINS (optional, comma-separated CORS origins)

# Custom domain configuration
# Using idling.app domain
routes = [
  { pattern = "chat.idling.app/*", zone_name = "idling.app" }
]

# Alternative: Configure in Cloudflare Dashboard (recommended for production):
# 1. Go to Cloudflare Dashboard → Workers & Pages → strixun-chat-signaling
# 2. Go to Settings → Triggers → Routes
# 3. Add custom domain route: chat.idling.app/*
# 4. DNS records are automatically managed by Cloudflare
#
# Note: Routes configured in the dashboard take precedence over wrangler.toml

