# Game API Service - Cloudflare Worker Configuration
# Dedicated worker for idle game API endpoints

name = "strixun-game-api"
main = "worker.js"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]

# KV Namespace for game data
# Created via: wrangler kv namespace create "GAME_API_KV"
[[kv_namespaces]]
binding = "GAME_KV"
id = "cc95b32546e14dfbb6c36f8e3d96f13f"  # TODO: Create namespace and update this ID
# To create: cd serverless/game-api && wrangler kv namespace create "GAME_API_KV"

# Environment variables (secrets should be set via wrangler secret put)
# DO NOT put actual secrets here - use wrangler CLI:
#   wrangler secret put JWT_SECRET          # REQUIRED: JWT signing secret (must match OTP auth service)
#   wrangler secret put ALLOWED_ORIGINS     # OPTIONAL: Comma-separated CORS origins (recommended for production)
#
# IMPORTANT: JWT_SECRET must match the OTP auth service secret for authentication to work

[vars]
ENVIRONMENT = "production"

# Custom domain configuration
# Using idling.app domain
routes = [
  { pattern = "game.idling.app/*", zone_name = "idling.app" }
]

# Alternative: Configure in Cloudflare Dashboard (recommended for production):
# 1. Go to Cloudflare Dashboard → Workers & Pages → strixun-game-api
# 2. Go to Settings → Triggers → Routes
# 3. Add custom domain route: game.idling.app/*
# 4. DNS records are automatically managed by Cloudflare
#
# Note: Routes configured in the dashboard take precedence over wrangler.toml

# Observability Configuration
# Enables logging and tracing for the worker
[observability]
enabled = true
head_sampling_rate = 1

[observability.logs]
enabled = true
head_sampling_rate = 1
persist = true
invocation_logs = true

[observability.traces]
enabled = false
persist = true
head_sampling_rate = 1

