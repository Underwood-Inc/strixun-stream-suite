# Access Service - Cloudflare Worker Configuration
# Handles access control decisions, roles, permissions, and quotas
# Service-agnostic: works for ANY service (mods, customer, analytics, etc.)

name = "strixun-access-service"
main = "worker.ts"
compatibility_date = "2024-12-01"
compatibility_flags = ["nodejs_compat"]

# Environment variables (secrets should be set via wrangler secret put)
# DO NOT put actual secrets here - use wrangler CLI:
#   wrangler secret put JWT_SECRET          # REQUIRED: JWT signing secret (must match OTP auth service)
#   wrangler secret put SERVICE_API_KEY     # REQUIRED: API key for service-to-service authentication
#   wrangler secret put SUPER_ADMIN_API_KEY # REQUIRED: API key for super admin access
#   wrangler secret put ALLOWED_ORIGINS     # OPTIONAL: Comma-separated CORS origins (recommended for production)

# Production environment (default)
[vars]
ENVIRONMENT = "production"

# Production KV Namespace for access control data
[[kv_namespaces]]
binding = "ACCESS_KV"
id = "ee3fee37d3d74ffdb7ebeeae4b0d86ff"

# Production routes - Custom domain for service-to-service calls
[[routes]]
pattern = "access.idling.app"
zone_name = "idling.app"
custom_domain = true

# Development environment (uses shared KV namespaces for local testing)
[env.development]

[env.development.vars]
ENVIRONMENT = "development"
ACCESS_SERVICE_URL = "http://localhost:8791"

# Development KV Namespace (shares production namespace for local testing)
[[env.development.kv_namespaces]]
binding = "ACCESS_KV"
id = "ee3fee37d3d74ffdb7ebeeae4b0d86ff"

# Observability Configuration
[observability]
enabled = true
head_sampling_rate = 1

[observability.logs]
enabled = true
head_sampling_rate = 1
persist = true
invocation_logs = true
